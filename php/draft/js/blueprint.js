"use strict";var blueprint=new function(){this.version="0.0.1",this.mode="selector",this.component=void 0,this.base=void 0,this.layers=[],this.count=0,this.abs={},this.obj={},this.drag={},this.zoom=1,this.selected=void 0,this.def=void 0,this.stack=void 0,this.group=void 0,this.origin=void 0,this.init=function(a){this.base=d3.select(a).append("svg:svg").attr("width","100%").attr("height","100%").attr("preserveAspectRatio","xMidYMid meet").attr("pointer-events","all").attr("transform","matrix(1 0 0 1 0 0)");var b=this.base.append("svg:defs");b.append("svg:marker").attr("id","head").attr("orient","auto").attr("markerWidth","13").attr("markerHeight","13").attr("refX","-10").attr("refY","6").append("svg:path").attr("d","M 2 6 L 8 10 L 8 2 Z").attr("fill","#909090"),b.append("svg:marker").attr("id","tail").attr("orient","auto").attr("markerWidth","13").attr("markerHeight","13").attr("refX","-10").attr("refY","6").append("svg:path").attr("d","M 2 2 L 2 10 L 9 6 Z").attr("fill","#909090"),this.layers.push(this.base.append("svg:rect").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("class","base").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).on("click",blueprint.click).on("dblclick",blueprint.dblclick)),this.layers.push(this.base.append("svg:g").attr("id","main"))},this.setmode=function(a,b){blueprint.mode=a,blueprint.component=b,blueprint.deselect()},this.getid=function(){return"obj"+ ++this.count},this.remove=function(){if(blueprint.selected){var a=blueprint.selected;blueprint.deselect(),a.remove()}},this.mousedown=function(){"selector"!=blueprint.mode&&(blueprint.component in blueprint.obj&&(blueprint.selected?blueprint.obj[blueprint.component].next(d3.mouse(this)[0],d3.mouse(this)[1]):blueprint.obj[blueprint.component].start(d3.mouse(this)[0],d3.mouse(this)[1],[blueprint.component])),d3.event.stopPropagation())},this.mousemove=function(){"selector"!=blueprint.mode&&void 0!=blueprint.selected&&(blueprint.component in blueprint.obj&&blueprint.obj[blueprint.component].prev(d3.mouse(this)[0],d3.mouse(this)[1]),d3.event.stopPropagation())},this.click=function(){if("draw"!=blueprint.mode){var a=d3.select(this),b=a.attr("class").split(" ");"base"==b?blueprint.deselect():b&&b.length>0&&b[0]in blueprint.obj&&blueprint.obj[b[0]].select(a)}},this.deselect=function(){if(blueprint.selected){var a=d3.select(blueprint.selected);a.on(".drag",void 0),blueprint.layers[1].selectAll(".handle").remove(),blueprint.selected=void 0,blueprint.def=void 0}},this.keydown=function(a){switch(console.log("=>",a.key),a.key){case"Escape":if("draw"==blueprint.mode&&blueprint.selected&&blueprint.component in blueprint.obj)return blueprint.obj[blueprint.component].cancel(),!0;break;case"Enter":if("draw"==blueprint.mode&&blueprint.selected&&blueprint.component in blueprint.obj)return blueprint.obj[blueprint.component].end(),!0;break;case"ArrowRight":return blueprint.nav.right(30),!0;case"ArrowUp":return blueprint.nav.up(30),!0;case"ArrowLeft":return blueprint.nav.left(30),!0;case"ArrowDown":return blueprint.nav.down(30),!0;case"-":return blueprint.nav.zoomout(),!0;case"+":return blueprint.nav.zoomin(),!0}return!1},this.nav={generic:function(a,b){var c=d3.select("svg"),d=c.attr("transform"),e=/matrix\((.+) (.+) (.+) (.+) (.+) (.+)\)/,f=e.exec(d),g=[f[1],f[2],f[3],f[4],f[5],f[6]];d3.select("svg").attr("transform","matrix("+b(g,a).join(" ")+")")},exp:function(a){return Math.pow(Math.E,(a-1)/6)},left:function(a){blueprint.nav.generic(a,function(a,b){return a[4]=+a[4]+b,d3.selectAll(".base").attr("x",-1*a[4]),a})},right:function(a){blueprint.nav.generic(a,function(a,b){return a[4]=+a[4]-b,d3.selectAll(".base").attr("x",-1*a[4]),a})},up:function(a){blueprint.nav.generic(a,function(a,b){return a[5]=+a[5]+b,d3.selectAll(".base").attr("y",-1*a[5]),a})},down:function(a){blueprint.nav.generic(a,function(a,b){return a[5]=+a[5]-b,d3.selectAll(".base").attr("y",-1*a[5]),a})},zoomout:function(a){blueprint.nav.generic(a,function(a,b){return blueprint.zoom--,a[0]=blueprint.nav.exp(blueprint.zoom),a[3]=blueprint.nav.exp(blueprint.zoom),a})},zoomin:function(a){blueprint.nav.generic(a,function(a,b){return blueprint.zoom++,a[0]=blueprint.nav.exp(blueprint.zoom),a[3]=blueprint.nav.exp(blueprint.zoom),a})}},this.translate=function(a,b){for(var c=0;c<a.length;c++)"M"==a[c]||"L"==a[c]?(a[c+1]=+a[c+1]+b[0],a[c+2]=+a[c+2]+b[1],c+=2):"A"==a[c]&&(a[c+6]=+a[c+6]+b[0],a[c+7]=+a[c+7]+b[1],c+=7);return a},this.rotate=function(a,b,c){for(var d=[],e=0;e<a.length;e++)"M"==a[e]||"L"==a[e]?(d=[+a[e+1],+a[e+2]],a[e+1]=b[1]+(d[0]-b[1])*c[0]-(d[1]-b[2])*c[1],a[e+2]=b[2]+(d[0]-b[1])*c[1]+(d[1]-b[2])*c[0],e+=2):"A"==a[e]&&(d=[+a[e+6],+a[e+7]],a[e+6]=b[1]+(d[0]-b[1])*c[0]-(d[1]-b[2])*c[1],a[e+7]=b[2]+(d[0]-b[1])*c[1]+(d[1]-b[2])*c[0],e+=7);return a}};blueprint.drag.translate=d3.drag().on("start",function(){blueprint.origin=d3.mouse(this),d3.event.sourceEvent.stopPropagation()}).on("drag",function(){var a=[d3.event.x-blueprint.origin[0],d3.event.y-blueprint.origin[1]],b="translate("+a[0]+","+a[1]+")";blueprint.selected.attr("transform",b),d3.selectAll(".handle").attr("transform",b)}).on("end",function(){var a=/translate\((.+),(.+)\)/.exec(blueprint.selected.attr("transform")),b=[+a[1],+a[2]];if(blueprint.def.group)blueprint.selected.selectAll("path").each(function(a,c){var d=d3.select(this),e=d.attr("d").split(" ");d.attr("d",blueprint.translate(e,b).join(" "))}),blueprint.def.custom&&blueprint.def.translate(b),blueprint.selected.attr("transform",void 0);else switch(blueprint.selected._groups[0][0].tagName){case"text":var c=blueprint.selected.attr("x"),d=blueprint.selected.attr("y");blueprint.selected.attr("x",+c+b[0]).attr("y",+d+b[1]).attr("transform",void 0);break;case"path":var e=blueprint.selected.attr("d").split(" ");blueprint.selected.attr("d",blueprint.translate(e,b).join(" ")).attr("transform",void 0)}blueprint.def.select(blueprint.selected),blueprint.origin=void 0}),blueprint.drag.rotate=d3.drag().on("start",function(){blueprint.origin=d3.mouse(this),d3.event.sourceEvent.stopPropagation()}).on("drag",function(){var a=d3.select("#centre"),b=[+a.attr("cx"),+a.attr("cy")],c=[d3.event.x-b[0],d3.event.y-b[1]],d=[blueprint.origin[0]-b[0],blueprint.origin[1]-b[1]],e=Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2)),f=Math.sqrt(Math.pow(d[0],2)+Math.pow(d[1],2)),g=180*Math.acos((c[0]*d[0]+c[1]*d[1])/(e*f))/Math.PI,h=d[1]/d[0],i=d3.event.y-h*d3.event.x+h*b[0]-b[1]>0?-1:1,j="rotate("+g*i+","+b[0]+","+b[1]+")";blueprint.selected.attr("transform",j),d3.selectAll(".handle").attr("transform",j)}).on("end",function(){var a=/rotate\((.+),(.+),(.+)\)/.exec(blueprint.selected.attr("transform")),b=[+a[1]*Math.PI/180,+a[2],+a[3]],c=[Math.cos(b[0]),Math.sin(b[0])];if(blueprint.def.group)blueprint.selected.selectAll("path").each(function(a,d){var e=d3.select(this),f=e.attr("d").split(" ");e.attr("d",blueprint.rotate(f,b,c).join(" "))}),blueprint.def.custom&&blueprint.def.rotate(b,c),blueprint.selected.attr("transform",void 0);else switch(blueprint.selected._groups[0][0].tagName){case"text":var d=blueprint.selected.attr("x"),e=blueprint.selected.attr("y");blueprint.selected.attr("x",b[1]+(d-b[1])*c[0]-(e-b[2])*c[1]).attr("y",b[2]+(d-b[1])*c[1]+(e-b[2])*c[0]).attr("transform",void 0);break;case"path":var f=blueprint.selected.attr("d").split(" ");blueprint.selected.attr("d",blueprint.rotate(f,b,c).join(" ")).attr("transform",void 0)}blueprint.def.select(blueprint.selected),blueprint.origin=void 0}),blueprint.drag.centre=d3.drag().on("start",function(){blueprint.origin=d3.mouse(this),d3.event.sourceEvent.stopPropagation()}).on("drag",function(){d3.select("#axis").attr("x1",d3.event.x).attr("y1",d3.event.y),d3.select(this).attr("cx",d3.event.x).attr("cy",d3.event.y)}),blueprint.drag.handle=d3.drag().on("start",function(){blueprint.origin=d3.mouse(this),d3.event.sourceEvent.stopPropagation(),d3.selectAll("#axis,#translate,#rotate,#centre").remove()}).on("drag",function(){if(blueprint.def.group){var a=blueprint.selected.select("path").attr("d").split(" ");switch(this.id){case"handle1":blueprint.def.draw(d3.event.x,d3.event.y,+a[4],+a[5]);break;case"handle2":blueprint.def.draw(+a[1],+a[2],d3.event.x,d3.event.y)}}else{var a=blueprint.selected.attr("d").split(" "),b=3*(+this.id.substring(6)-1)+1;a[b]=d3.event.x,a[b+1]=d3.event.y,blueprint.selected.attr("d",a.join(" "))}d3.select(this).attr("cx",d3.event.x).attr("cy",d3.event.y)}).on("end",function(){blueprint.def.select(blueprint.selected),blueprint.origin=void 0}),blueprint.drag.rect=d3.drag().on("start",function(){blueprint.origin=d3.mouse(this),d3.event.sourceEvent.stopPropagation(),d3.selectAll("#axis,#translate,#rotate,#centre").remove()}).on("drag",function(){if(blueprint.def.group)var a=blueprint.selected.select("path");else var a=blueprint.selected;var b=a.attr("d").split(" "),c=+this.id.substring(6)-1,d=function(a,b,c,d,e){var f=[e[0]-a[0],e[1]-a[1]],g=[b[0]-a[0],b[1]-a[1]],h=[d[0]-a[0],d[1]-a[1]],i=Math.sqrt(g[0]*g[0]+g[1]*g[1]),j=Math.sqrt(h[0]*h[0]+h[1]*h[1]),k=(f[0]*g[0]+f[1]*g[1])/(i*i),l=(f[0]*h[0]+f[1]*h[1])/(j*j);return[a[0]+k*g[0],a[1]+k*g[1],a[0]+l*h[0],a[1]+l*h[1]]};switch(c){case 0:var e=d([+b[7],+b[8]],[+b[10],+b[11]],[+b[1],+b[2]],[+b[4],+b[5]],[d3.event.x,d3.event.y]);a.attr("d",["M",d3.event.x,d3.event.y,"L",e[2],e[3],"L",+b[7],+b[8],"L",e[0],e[1],"Z"].join(" ")),blueprint.def.custom&&blueprint.def.draw(d3.event.x,d3.event.y,+b[7],+b[8]);break;case 1:var e=d([+b[10],+b[11]],[+b[1],+b[2]],[+b[4],+b[5]],[+b[7],+b[8]],[d3.event.x,d3.event.y]);a.attr("d",["M",e[0],e[1],"L",d3.event.x,d3.event.y,"L",e[2],e[3],"L",+b[10],+b[11],"Z"].join(" ")),blueprint.def.custom&&blueprint.def.draw(e[0],e[1],e[2],e[3]);break;case 2:var e=d([+b[1],+b[2]],[+b[4],+b[5]],[+b[7],+b[8]],[+b[10],+b[11]],[d3.event.x,d3.event.y]);a.attr("d",["M",+b[1],+b[2],"L",e[0],e[1],"L",d3.event.x,d3.event.y,"L",e[2],e[3],"Z"].join(" ")),blueprint.def.custom&&blueprint.def.draw(+b[1],+b[2],d3.event.x,d3.event.y);break;case 3:var e=d([+b[4],+b[5]],[+b[7],+b[8]],[+b[10],+b[11]],[+b[1],+b[2]],[d3.event.x,d3.event.y]);a.attr("d",["M",e[2],e[3],"L",+b[4],+b[5],"L",e[0],e[1],"L",d3.event.x,d3.event.y,"Z"].join(" ")),blueprint.def.custom&&blueprint.def.draw(e[2],e[3],e[0],e[1])}d3.select(this).attr("cx",d3.event.x).attr("cy",d3.event.y)}).on("end",function(){blueprint.def.select(blueprint.selected),blueprint.origin=void 0}),blueprint.drag.arc=d3.drag().on("start",function(){blueprint.origin=d3.mouse(this),d3.event.sourceEvent.stopPropagation(),d3.selectAll("#axis,#translate,#rotate,#centre").remove()}).on("drag",function(){if(blueprint.def.group)var a=blueprint.selected.select("path");else var a=blueprint.selected;var b=a.attr("d").split(" "),c=+this.id.substring(6)-1,d=function(a,b,c,d,e){var f=[e[0]-a[0],e[1]-a[1]],g=[b[0]-a[0],b[1]-a[1]],h=[d[0]-a[0],d[1]-a[1]],i=Math.sqrt(g[0]*g[0]+g[1]*g[1]),j=Math.sqrt(h[0]*h[0]+h[1]*h[1]),k=(f[0]*g[0]+f[1]*g[1])/(i*i),l=(f[0]*h[0]+f[1]*h[1])/(j*j);return[a[0]+k*g[0],a[1]+k*g[1],a[0]+l*h[0],a[1]+l*h[1]]};switch(c){case 0:var e=d([+b[7],+b[8]],[+b[10],+b[11]],[+b[1],+b[2]],[+b[4],+b[5]],[d3.event.x,d3.event.y]),f=blueprint.obj.arc.render(d3.event.x,d3.event.y,e[2],e[3],+b[7],+b[8]).concat("Z");a.attr("d",f.join(" "));break;case 1:var e=d([+b[1]+(+b[7]-+b[4]),+b[2]+(+b[8]-+b[5])],[+b[1],+b[2]],[+b[4],+b[5]],[+b[7],+b[8]],[d3.event.x,d3.event.y]),f=blueprint.obj.arc.render(e[0],e[1],d3.event.x,d3.event.y,e[2],e[3]).concat("Z");a.attr("d",f.join(" "));break;case 2:var e=d([+b[1],+b[2]],[+b[4],+b[5]],[+b[7],+b[8]],[+b[10],+b[11]],[d3.event.x,d3.event.y]),f=blueprint.obj.arc.render(+b[1],+b[2],e[0],e[1],d3.event.x,d3.event.y).concat("Z");a.attr("d",f.join(" "));break;case 3:}d3.select(this).attr("cx",d3.event.x).attr("cy",d3.event.y)}).on("end",function(){blueprint.def.select(blueprint.selected),blueprint.origin=void 0}),blueprint.drag.install=d3.drag().on("start",function(){blueprint.origin=d3.mouse(this),d3.event.sourceEvent.stopPropagation(),d3.selectAll("#axis,#translate,#rotate,#centre").remove()}).on("drag",function(){var a=blueprint.selected.select("path"),b=a.attr("d").split(" "),c=+this.id.substring(6)-1;switch(c){case 0:blueprint.def.draw(d3.event.x,d3.event.y,+b[4],+b[5]);break;case 1:blueprint.def.draw(+b[1],+b[2],d3.event.x,d3.event.y)}d3.select(this).attr("cx",d3.event.x).attr("cy",d3.event.y)}).on("end",function(){blueprint.def.select(blueprint.selected),blueprint.origin=void 0}),blueprint.abs.simple={},blueprint.abs.simple.start=function(a,b,c){blueprint.stack=[a,b],blueprint.selected=blueprint.layers[1].append("svg:path").attr("class",c.join(" ")).on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove)},blueprint.abs.simple.next=function(){blueprint.selected.attr("id",blueprint.getid()).on("click",blueprint.click),blueprint.selected=void 0,blueprint.stack=void 0,blueprint.group=void 0},blueprint.abs.simple.end=blueprint.abs.simple.next,blueprint.abs.simple.cancel=function(){blueprint.selected.remove(),blueprint.selected=void 0,blueprint.stack=void 0,blueprint.group=void 0},blueprint.abs.simple.select=function(a){var b=a.attr("d").split(" ").filter(function(a,b){return b%3!=0}).map(function(a){return+a}),c=Math.atan((b[3]-b[1])/(b[2]-b[0])),d=30,e=[b[0]+(b[2]-b[0])/2,b[1]+(b[3]-b[1])/2];blueprint.deselect(),blueprint.selected=a,blueprint.def=blueprint.obj[a.attr("class").split(" ")[0]];for(var f=1,g=0;g<b.length;g+=2)blueprint.layers[1].append("svg:circle").attr("id","handle"+f++).attr("cx",b[g]).attr("cy",b[g+1]).attr("r",4).attr("class","handle vertex").call(blueprint.drag.handle);blueprint.layers[1].append("svg:line").attr("id","axis").attr("x1",e[0]).attr("y1",e[1]).attr("x2",e[0]+3*d*Math.sin(-c)).attr("y2",e[1]+3*d*Math.cos(-c)).attr("class","handle axis"),blueprint.layers[1].append("svg:circle").attr("id","translate").attr("cx",e[0]-d*Math.sin(-c)).attr("cy",e[1]-d*Math.cos(-c)).attr("r",4).attr("class","handle translate").call(blueprint.drag.translate),blueprint.layers[1].append("svg:circle").attr("id","rotate").attr("cx",e[0]+3*d*Math.sin(-c)).attr("cy",e[1]+3*d*Math.cos(-c)).attr("r",4).attr("class","handle rotate").call(blueprint.drag.rotate),blueprint.layers[1].append("svg:circle").attr("id","centre").attr("cx",e[0]).attr("cy",e[1]).attr("r",4).attr("class","handle centre").call(blueprint.drag.centre)},blueprint.abs.multiple={},blueprint.abs.multiple.start=function(a,b,c){blueprint.stack=["M",a,b],blueprint.selected=blueprint.layers[1].append("svg:path").attr("class",c.join(" ")).on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove)},blueprint.abs.multiple.prev=function(a,b){blueprint.selected.attr("d",blueprint.stack.concat(["L",a,b]).join(" "))},blueprint.abs.multiple.next=function(a,b){blueprint.stack=blueprint.stack.concat(["L",a,b]),blueprint.selected.attr("d",blueprint.stack.join(" "))},blueprint.abs.multiple.cancel=blueprint.abs.simple.cancel,blueprint.abs.multiple.end=function(){blueprint.stack.length<6?blueprint.abs.multiple.cancel():(blueprint.selected.attr("id",blueprint.getid()).on("click",blueprint.click),blueprint.selected=void 0,blueprint.stack=void 0,blueprint.group=void 0)},blueprint.abs.multiple.add=function(a,b){blueprint.layers[1].append("svg:path").attr("d",b.join(" ")).attr("class",a.join(" ")).attr("id",blueprint.getid())},blueprint.abs.compose2={},blueprint.abs.compose2.start=function(a,b,c,d){blueprint.stack=[a,b],blueprint.selected=blueprint.layers[1].append("svg:g").attr("class",c.join(" ")).on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.group=[];for(var e=0;d>e;e++)blueprint.group.push(blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove))},blueprint.abs.compose2.select=function(a){blueprint.group=[],a.selectAll("path").each(function(a,b){blueprint.group.push(d3.select(this))});var b=blueprint.group[0],c=b.attr("d").split(" ").filter(function(a,b){return b%3!=0}).map(function(a){return+a}),d=Math.atan((c[3]-c[1])/(c[2]-c[0])),e=30,f=[c[0]+(c[2]-c[0])/2,c[1]+(c[3]-c[1])/2];blueprint.deselect(),blueprint.selected=a,blueprint.def=blueprint.obj[a.attr("class").split(" ")[0]],blueprint.layers[1].append("svg:circle").attr("id","handle1").attr("cx",c[0]).attr("cy",c[1]).attr("r",4).attr("class","handle vertex").call(blueprint.drag.handle),blueprint.layers[1].append("svg:circle").attr("id","handle2").attr("cx",c[2]).attr("cy",c[3]).attr("r",4).attr("class","handle vertex").call(blueprint.drag.handle),blueprint.layers[1].append("svg:line").attr("id","axis").attr("x1",f[0]).attr("y1",f[1]).attr("x2",f[0]+3*e*Math.sin(-d)).attr("y2",f[1]+3*e*Math.cos(-d)).attr("class","handle axis"),blueprint.layers[1].append("svg:circle").attr("id","translate").attr("cx",f[0]-e*Math.sin(-d)).attr("cy",f[1]-e*Math.cos(-d)).attr("r",4).attr("class","handle translate").call(blueprint.drag.translate),blueprint.layers[1].append("svg:circle").attr("id","rotate").attr("cx",f[0]+3*e*Math.sin(-d)).attr("cy",f[1]+3*e*Math.cos(-d)).attr("r",4).attr("class","handle rotate").call(blueprint.drag.rotate),blueprint.layers[1].append("svg:circle").attr("id","centre").attr("cx",f[0]).attr("cy",f[1]).attr("r",4).attr("class","handle centre").call(blueprint.drag.centre)},blueprint.abs.graph2={},blueprint.abs.graph2.translate=function(a){var b=blueprint.selected.select("image"),c=blueprint.selected.select("path").attr("d").split(" "),d=/rotate\((.+),(.+),(.+)\)/.exec(b.attr("transform")),e=(+c[1]+ +c[4]+ +c[7]+ +c[10])/4,f=e-+b.attr("width")/2,g=(+c[2]+ +c[5]+ +c[8]+ +c[11])/4,h=g-+b.attr("height")/2;b.attr("x",f).attr("y",h).attr("transform","rotate("+d[1]+","+e+","+g+")")},blueprint.abs.graph2.rotate=function(a,b){var c=blueprint.selected.select("image"),d=blueprint.selected.select("path").attr("d").split(" "),e=/rotate\((.+),(.+),(.+)\)/.exec(c.attr("transform")),f=(+d[1]+ +d[4]+ +d[7]+ +d[10])/4,g=f-+c.attr("width")/2,h=(+d[2]+ +d[5]+ +d[8]+ +d[11])/4,i=h-+c.attr("height")/2,b=180*a[0]/Math.PI;c.attr("x",g).attr("y",i).attr("transform","rotate("+(+e[1]+b)+","+f+","+h+")")},blueprint.abs.graph2.draw=function(a,b,c,d,e){var f=c>a?a:c,g=d>b?b:d,h=c>a?c:a,i=d>b?d:b,j=f+(h-f)/2,k=g+(i-g)/2;2==blueprint.group.length?(blueprint.group[0].attr("d",["M",f,g,"L",f,i,"L",h,i,"L",h,g].join(" ")),blueprint.group[1].attr("x",f).attr("y",g).attr("width",h-f).attr("height",i-g).attr("transform","rotate(0,"+j+","+k+")").attr("xlink:href","svg/obj/"+e+".svg")):blueprint.selected.select("image").attr("x",f).attr("y",g).attr("width",h-f).attr("height",i-g).attr("transform","rotate(0,"+j+","+k+")").attr("xlink:href","svg/obj/"+e+".svg")},blueprint.abs.graph2.start=function(a,b,c){blueprint.stack=[a,b],blueprint.selected=blueprint.layers[1].append("svg:g").attr("class",c.join(" ")).on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.group=[blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:image").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove)]},blueprint.abs.graph2.add=function(a,b,c){blueprint.abs.graph2.start(+b[1],+b[2],a),blueprint.group[0].attr("d",b.join(" ")),blueprint.group[1].attr("x",c[0]).attr("y",c[1]).attr("width",c[2]).attr("height",c[3]).attr("transform",c[4]).attr("xlink:href","svg/obj/"+a[0]+".svg"),blueprint.abs.simple.next()},blueprint.abs.graph2.select=function(a){blueprint.group=[],a.selectAll("path").each(function(a,b){blueprint.group.push(d3.select(this))});var b=blueprint.group[0],c=b.attr("d").split(" ").filter(function(a,b){return b%3!=0}).map(function(a){return+a}),d=Math.atan((c[3]-c[1])/(c[2]-c[0])),e=30,f=[c[0]+(c[2]-c[0])/2,c[1]+(c[3]-c[1])/2];blueprint.deselect(),blueprint.selected=a,blueprint.def=blueprint.obj[a.attr("class").split(" ")[0]],blueprint.layers[1].append("svg:circle").attr("id","handle1").attr("cx",c[0]).attr("cy",c[1]).attr("r",4).attr("class","handle vertex").call(blueprint.drag.rect),blueprint.layers[1].append("svg:circle").attr("id","handle2").attr("cx",c[2]).attr("cy",c[3]).attr("r",4).attr("class","handle vertex").call(blueprint.drag.rect),blueprint.layers[1].append("svg:circle").attr("id","handle3").attr("cx",c[4]).attr("cy",c[5]).attr("r",4).attr("class","handle vertex").call(blueprint.drag.rect),blueprint.layers[1].append("svg:circle").attr("id","handle4").attr("cx",c[6]).attr("cy",c[7]).attr("r",4).attr("class","handle vertex").call(blueprint.drag.rect),blueprint.layers[1].append("svg:line").attr("id","axis").attr("x1",f[0]).attr("y1",f[1]).attr("x2",f[0]+3*e*Math.sin(-d)).attr("y2",f[1]+3*e*Math.cos(-d)).attr("class","handle axis"),blueprint.layers[1].append("svg:circle").attr("id","translate").attr("cx",f[0]-e*Math.sin(-d)).attr("cy",f[1]-e*Math.cos(-d)).attr("r",4).attr("class","handle translate").call(blueprint.drag.translate),blueprint.layers[1].append("svg:circle").attr("id","rotate").attr("cx",f[0]+3*e*Math.sin(-d)).attr("cy",f[1]+3*e*Math.cos(-d)).attr("r",4).attr("class","handle rotate").call(blueprint.drag.rotate),blueprint.layers[1].append("svg:circle").attr("id","centre").attr("cx",f[0]).attr("cy",f[1]).attr("r",4).attr("class","handle centre").call(blueprint.drag.centre)},blueprint.abs.install={},blueprint.abs.install.select=function(a){blueprint.group=[],a.selectAll("path,circle,text").each(function(a,b){blueprint.group.push(d3.select(this))});var b=blueprint.group[0],c=b.attr("d").split(" ").filter(function(a,b){return b%3!=0}).map(function(a){return+a});Math.atan((c[3]-c[1])/(c[2]-c[0])),[c[0]+(c[2]-c[0])/2,c[1]+(c[3]-c[1])/2];blueprint.deselect(),blueprint.selected=a,blueprint.def=blueprint.obj[a.attr("class").split(" ")[0]],blueprint.layers[1].append("svg:circle").attr("id","handle1").attr("cx",c[0]).attr("cy",c[1]).attr("r",4).attr("class","handle vertex").call(blueprint.drag.install),blueprint.layers[1].append("svg:circle").attr("id","handle2").attr("cx",c[2]).attr("cy",c[3]).attr("r",4).attr("class","handle vertex").call(blueprint.drag.install)},blueprint.obj.line={group:!1},blueprint.obj.line.draw=function(a,b,c,d){blueprint.selected.attr("d",["M",a,b,"L",c,d].join(" "))},blueprint.obj.line.start=blueprint.abs.simple.start,blueprint.obj.line.prev=function(a,b){blueprint.obj.line.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.line.next=blueprint.abs.simple.next,blueprint.obj.line.end=blueprint.abs.simple.end,blueprint.obj.line.cancel=blueprint.abs.simple.cancel,blueprint.obj.line.add=function(a,b){blueprint.abs.simple.start(+b[1],+b[2],a),blueprint.obj.line.draw(+b[1],+b[2],+b[4],+b[5]),blueprint.obj.line.end()},blueprint.obj.line.select=blueprint.abs.simple.select,blueprint.obj.line1={group:!1},blueprint.obj.line1.draw=blueprint.obj.line.draw,blueprint.obj.line1.start=blueprint.obj.line.start,blueprint.obj.line1.prev=blueprint.obj.line.prev,blueprint.obj.line1.next=blueprint.obj.line.next,blueprint.obj.line1.end=blueprint.obj.line.end,blueprint.obj.line1.cancel=blueprint.obj.line.cancel,blueprint.obj.line1.add=blueprint.obj.line.add,blueprint.obj.line1.select=blueprint.obj.line.select,blueprint.obj.line2={group:!1},blueprint.obj.line2.draw=blueprint.obj.line.draw,blueprint.obj.line2.start=blueprint.obj.line.start,blueprint.obj.line2.prev=blueprint.obj.line.prev,blueprint.obj.line2.next=blueprint.obj.line.next,blueprint.obj.line2.end=blueprint.obj.line.end,blueprint.obj.line2.cancel=blueprint.obj.line.cancel,blueprint.obj.line2.add=blueprint.obj.line.add,blueprint.obj.line2.select=blueprint.obj.line.select,blueprint.obj.polyline={group:!1},blueprint.obj.polyline.start=blueprint.abs.multiple.start,blueprint.obj.polyline.prev=blueprint.abs.multiple.prev,blueprint.obj.polyline.next=blueprint.abs.multiple.next,blueprint.obj.polyline.cancel=blueprint.abs.multiple.cancel,blueprint.obj.polyline.end=blueprint.abs.multiple.end,blueprint.obj.polyline.add=blueprint.abs.multiple.add,blueprint.obj.polyline.select=blueprint.abs.simple.select,blueprint.obj.polyline1={group:!1},blueprint.obj.polyline1.start=blueprint.obj.polyline.start,blueprint.obj.polyline1.prev=blueprint.obj.polyline.prev,blueprint.obj.polyline1.next=blueprint.obj.polyline.next,blueprint.obj.polyline1.cancel=blueprint.obj.polyline.cancel,blueprint.obj.polyline1.end=blueprint.obj.polyline.end,blueprint.obj.polyline1.add=blueprint.obj.polyline.add,blueprint.obj.polyline1.select=blueprint.obj.polyline.select,blueprint.obj.polyline2={group:!1},blueprint.obj.polyline2.start=blueprint.obj.polyline.start,blueprint.obj.polyline2.prev=blueprint.obj.polyline.prev,blueprint.obj.polyline2.next=blueprint.obj.polyline.next,blueprint.obj.polyline2.cancel=blueprint.obj.polyline.cancel,blueprint.obj.polyline2.end=blueprint.obj.polyline.end,blueprint.obj.polyline2.add=blueprint.obj.polyline.add,blueprint.obj.polyline2.select=blueprint.obj.polyline.select,blueprint.obj.gasline1={group:!1},blueprint.obj.gasline1.start=blueprint.obj.polyline.start,blueprint.obj.gasline1.prev=blueprint.obj.polyline.prev,blueprint.obj.gasline1.next=blueprint.obj.polyline.next,blueprint.obj.gasline1.cancel=blueprint.obj.polyline.cancel,blueprint.obj.gasline1.end=blueprint.obj.polyline.end,blueprint.obj.gasline1.add=blueprint.obj.polyline.add,blueprint.obj.gasline1.select=blueprint.obj.polyline.select,blueprint.obj.gasline2={group:!1},blueprint.obj.gasline2.start=blueprint.obj.polyline.start,blueprint.obj.gasline2.prev=blueprint.obj.polyline.prev,blueprint.obj.gasline2.next=blueprint.obj.polyline.next,blueprint.obj.gasline2.cancel=blueprint.obj.polyline.cancel,blueprint.obj.gasline2.end=blueprint.obj.polyline.end,blueprint.obj.gasline2.add=blueprint.obj.polyline.add,blueprint.obj.gasline2.select=blueprint.obj.polyline.select,blueprint.obj.rect={group:!1},blueprint.obj.rect.start=blueprint.abs.multiple.start,blueprint.obj.rect.prev=function(a,b){if(3==blueprint.stack.length)blueprint.selected.attr("d",blueprint.stack.concat(["L",a,b]).join(" "));else if(6==blueprint.stack.length){var c=-(blueprint.stack[1]-blueprint.stack[4])/(blueprint.stack[2]-blueprint.stack[5]),d=c*(a-blueprint.stack[4]);blueprint.selected.attr("d",blueprint.stack.concat(["L",a,d+blueprint.stack[5],"L",a+(blueprint.stack[1]-blueprint.stack[4]),d+blueprint.stack[5]+(blueprint.stack[2]-blueprint.stack[5])]).join(" "))}},blueprint.obj.rect.next=function(a,b){3==blueprint.stack.length?(blueprint.stack=blueprint.stack.concat(["L",a,b]),blueprint.selected.attr("d",blueprint.stack.join(" "))):6==blueprint.stack.length&&(blueprint.selected.attr("d",blueprint.selected.attr("d")+" Z").attr("id",blueprint.getid()).on("click",blueprint.click),blueprint.stack=void 0,blueprint.selected=void 0,blueprint.group=void 0)},blueprint.obj.rect.cancel=blueprint.abs.multiple.cancel,blueprint.obj.rect.end=blueprint.obj.rect.next,blueprint.obj.rect.add=blueprint.abs.multiple.add,blueprint.obj.rect.select=function(a){var b=a.attr("d").split(" ").filter(function(a,b){return b%3!=0}).map(function(a){return+a}),c=Math.atan((b[3]-b[1])/(b[2]-b[0])),d=30,e=[b[0]+(b[2]-b[0])/2,b[1]+(b[3]-b[1])/2];blueprint.deselect(),blueprint.selected=a,blueprint.def=blueprint.obj[a.attr("class").split(" ")[0]];for(var f=1,g=0;g<b.length;g+=2)blueprint.layers[1].append("svg:circle").attr("id","handle"+f++).attr("cx",b[g]).attr("cy",b[g+1]).attr("r",4).attr("class","handle vertex").call(blueprint.drag.rect);blueprint.layers[1].append("svg:line").attr("id","axis").attr("x1",e[0]).attr("y1",e[1]).attr("x2",e[0]+3*d*Math.sin(-c)).attr("y2",e[1]+3*d*Math.cos(-c)).attr("class","handle axis"),blueprint.layers[1].append("svg:circle").attr("id","translate").attr("cx",e[0]-d*Math.sin(-c)).attr("cy",e[1]-d*Math.cos(-c)).attr("r",4).attr("class","handle translate").call(blueprint.drag.translate),blueprint.layers[1].append("svg:circle").attr("id","rotate").attr("cx",e[0]+3*d*Math.sin(-c)).attr("cy",e[1]+3*d*Math.cos(-c)).attr("r",4).attr("class","handle rotate").call(blueprint.drag.rotate),blueprint.layers[1].append("svg:circle").attr("id","centre").attr("cx",e[0]).attr("cy",e[1]).attr("r",4).attr("class","handle centre").call(blueprint.drag.centre)},blueprint.obj.rect1={group:!1},blueprint.obj.rect1.start=blueprint.obj.rect.start,blueprint.obj.rect1.prev=blueprint.obj.rect.prev,blueprint.obj.rect1.next=blueprint.obj.rect.next,blueprint.obj.rect1.cancel=blueprint.obj.rect.cancel,blueprint.obj.rect1.end=blueprint.obj.rect.end,blueprint.obj.rect1.add=blueprint.obj.rect.add,blueprint.obj.rect1.select=blueprint.obj.rect.select,blueprint.obj.rect2={group:!1},blueprint.obj.rect2.start=blueprint.obj.rect.start,blueprint.obj.rect2.prev=blueprint.obj.rect.prev,blueprint.obj.rect2.next=blueprint.obj.rect.next,blueprint.obj.rect2.cancel=blueprint.obj.rect.cancel,blueprint.obj.rect2.end=blueprint.obj.rect.end,blueprint.obj.rect2.add=blueprint.obj.rect.add,blueprint.obj.rect2.select=blueprint.obj.rect.select,blueprint.obj.polygon={group:!1},blueprint.obj.polygon.start=blueprint.abs.multiple.start,blueprint.obj.polygon.prev=blueprint.abs.multiple.prev,blueprint.obj.polygon.next=blueprint.abs.multiple.next,blueprint.obj.polygon.cancel=blueprint.abs.multiple.cancel,blueprint.obj.polygon.end=function(){blueprint.selected.attr("d",blueprint.selected.attr("d")+" Z"),blueprint.abs.multiple.end()},blueprint.obj.polygon.add=blueprint.abs.multiple.add,blueprint.obj.polygon.select=blueprint.abs.simple.select,blueprint.obj.polygon1={group:!1},blueprint.obj.polygon1.start=blueprint.obj.polygon.start,blueprint.obj.polygon1.prev=blueprint.obj.polygon.prev,blueprint.obj.polygon1.next=blueprint.obj.polygon.next,blueprint.obj.polygon1.cancel=blueprint.obj.polygon.cancel,blueprint.obj.polygon1.end=blueprint.obj.polygon.end,blueprint.obj.polygon1.add=blueprint.obj.polygon.add,blueprint.obj.polygon1.select=blueprint.obj.polygon.select,blueprint.obj.polygon2={group:!1},blueprint.obj.polygon2.start=blueprint.obj.polygon.start,blueprint.obj.polygon2.prev=blueprint.obj.polygon.prev,blueprint.obj.polygon2.next=blueprint.obj.polygon.next,blueprint.obj.polygon2.cancel=blueprint.obj.polygon.cancel,blueprint.obj.polygon2.end=blueprint.obj.polygon.end,blueprint.obj.polygon2.add=blueprint.obj.polygon.add,blueprint.obj.polygon2.select=blueprint.obj.polygon.select,blueprint.obj.arc={group:!1},blueprint.obj.arc.render=function(a,b,c,d,e,f){var g=Math.sqrt(Math.pow(a-c,2)+Math.pow(b-d,2)),h=Math.sqrt(Math.pow(c-e,2)+Math.pow(d-f,2)),i=[(a-c)/g,(b-d)/g],j=Math.min(g/2,h/2);if(h>g)var k=e+g/2*i[0],l=f+g/2*i[1],m=a+(h-g/2)*-i[1],n=b+(h-g/2)*i[0];else var k=e+(g-h/2)*i[0],l=f+(g-h/2)*i[1],m=a+h/2*-i[1],n=b+h/2*i[0];return["M",a,b,"L",c,d,"L",e,f,"L",k,l,"A",j,j,0,0,0,m,n]},blueprint.obj.arc.start=blueprint.abs.multiple.start,blueprint.obj.arc.prev=function(a,b){if(3==blueprint.stack.length)blueprint.selected.attr("d",blueprint.stack.concat(["L",a,b]).join(" "));else if(6==blueprint.stack.length){var c=[blueprint.stack[1],blueprint.stack[2],blueprint.stack[4],blueprint.stack[5]],d=Math.sqrt(Math.pow(a-c[2],2)+Math.pow(b-c[3],2)),e=Math.sqrt(Math.pow(c[0]-c[2],2)+Math.pow(c[1]-c[3],2)),f=[(c[0]-c[2])/e,(c[1]-c[3])/e];c.push(c[2]+d*-f[1]),c.push(c[3]+d*f[0]),blueprint.selected.attr("d",blueprint.obj.arc.render(c[0],c[1],c[2],c[3],c[4],c[5]).join(" "))}},blueprint.obj.arc.next=function(a,b){3==blueprint.stack.length?(blueprint.stack=blueprint.stack.concat(["L",a,b]),blueprint.selected.attr("d",blueprint.stack.join(" "))):6==blueprint.stack.length&&(blueprint.selected.attr("d",blueprint.selected.attr("d")+" Z").attr("id",blueprint.getid()).on("click",blueprint.click),blueprint.stack=void 0,blueprint.selected=void 0,blueprint.group=void 0)},blueprint.obj.arc.cancel=blueprint.abs.multiple.cancel,blueprint.obj.arc.end=blueprint.obj.arc.next,blueprint.obj.arc.add=blueprint.abs.multiple.add,blueprint.obj.arc.select=function(a){var b=a.attr("d").split(" "),c=[+b[7]-+b[4],+b[8]-+b[5]],d=Math.sqrt(c[0]*c[0]+c[1]*c[1]),e=[+b[1],+b[2],+b[4],+b[5],+b[7],+b[8],+b[10]-+b[13]*c[0]/d,+b[11]-+b[14]*c[1]/d],f=Math.atan((e[3]-e[1])/(e[2]-e[0])),g=30,h=[e[0]+(e[2]-e[0])/2,e[1]+(e[3]-e[1])/2];
blueprint.deselect(),blueprint.selected=a,blueprint.def=blueprint.obj[a.attr("class").split(" ")[0]];for(var i=1,j=0;j<e.length;j+=2)blueprint.layers[1].append("svg:circle").attr("id","handle"+i++).attr("cx",e[j]).attr("cy",e[j+1]).attr("r",4).attr("class","handle vertex").call(blueprint.drag.arc);blueprint.layers[1].append("svg:line").attr("id","axis").attr("x1",h[0]).attr("y1",h[1]).attr("x2",h[0]+3*g*Math.sin(-f)).attr("y2",h[1]+3*g*Math.cos(-f)).attr("class","handle axis"),blueprint.layers[1].append("svg:circle").attr("id","translate").attr("cx",h[0]-g*Math.sin(-f)).attr("cy",h[1]-g*Math.cos(-f)).attr("r",4).attr("class","handle translate").call(blueprint.drag.translate),blueprint.layers[1].append("svg:circle").attr("id","rotate").attr("cx",h[0]+3*g*Math.sin(-f)).attr("cy",h[1]+3*g*Math.cos(-f)).attr("r",4).attr("class","handle rotate").call(blueprint.drag.rotate),blueprint.layers[1].append("svg:circle").attr("id","centre").attr("cx",h[0]).attr("cy",h[1]).attr("r",4).attr("class","handle centre").call(blueprint.drag.centre)},blueprint.obj.arc1={group:!1},blueprint.obj.arc1.start=blueprint.obj.arc.start,blueprint.obj.arc1.prev=blueprint.obj.arc.prev,blueprint.obj.arc1.next=blueprint.obj.arc.next,blueprint.obj.arc1.cancel=blueprint.obj.arc.cancel,blueprint.obj.arc1.end=blueprint.obj.arc.end,blueprint.obj.arc1.add=blueprint.obj.arc.add,blueprint.obj.arc1.select=blueprint.obj.arc.select,blueprint.obj.arc2={group:!1},blueprint.obj.arc2.start=blueprint.obj.arc.start,blueprint.obj.arc2.prev=blueprint.obj.arc.prev,blueprint.obj.arc2.next=blueprint.obj.arc.next,blueprint.obj.arc2.cancel=blueprint.obj.arc.cancel,blueprint.obj.arc2.end=blueprint.obj.arc.end,blueprint.obj.arc2.add=blueprint.obj.arc.add,blueprint.obj.arc2.select=blueprint.obj.arc.select,blueprint.obj.door1={group:!0},blueprint.obj.door1.draw=function(a,b,c,d){var e=[c-a,d-b],f=[a+e[1],b-e[0]],g=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2));blueprint.group[0].attr("d",["M",a,b,"L",c,d].join(" ")),blueprint.group[1].attr("d",["M",a,b,"L",f[0],f[1]].join(" ")),blueprint.group[2].attr("d",["M",c,d,"A",g,g,0,0,0,f[0],f[1]].join(" "))},blueprint.obj.door1.start=function(a,b,c){blueprint.abs.compose2.start(a,b,c,3)},blueprint.obj.door1.prev=function(a,b){blueprint.obj.door1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.door1.next=blueprint.abs.simple.next,blueprint.obj.door1.end=blueprint.abs.simple.next,blueprint.obj.door1.cancel=blueprint.abs.simple.cancel,blueprint.obj.door1.add=function(a,b){blueprint.abs.compose2.start(+b[1],+b[2],a,3),blueprint.obj.door1.draw(+b[1],+b[2],+b[4],+b[5]),blueprint.abs.simple.next()},blueprint.obj.door1.select=blueprint.abs.compose2.select,blueprint.obj.door2={group:!0},blueprint.obj.door2.draw=function(a,b,c,d){var e=[a-c,b-d],f=[c-e[1],d+e[0]],g=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2));blueprint.group[0].attr("d",["M",a,b,"L",c,d].join(" ")),blueprint.group[1].attr("d",["M",c,d,"L",f[0],f[1]].join(" ")),blueprint.group[2].attr("d",["M",a,b,"A",g,g,0,0,1,f[0],f[1]].join(" "))},blueprint.obj.door2.start=function(a,b,c){blueprint.abs.compose2.start(a,b,c,3)},blueprint.obj.door2.prev=function(a,b){blueprint.obj.door2.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.door2.next=blueprint.abs.simple.next,blueprint.obj.door2.end=blueprint.abs.simple.next,blueprint.obj.door2.cancel=blueprint.abs.simple.cancel,blueprint.obj.door2.add=function(a,b){blueprint.abs.compose2.start(+b[1],+b[2],a,3),blueprint.obj.door2.draw(+b[1],+b[2],+b[4],+b[5]),blueprint.abs.simple.next()},blueprint.obj.door2.select=blueprint.abs.compose2.select,blueprint.obj.door3={group:!0},blueprint.obj.door3.draw=function(a,b,c,d){var e=[c-a,d-b],f=[a+e[1],b-e[0]],g=[a-e[1],b+e[0]],h=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2));blueprint.group[0].attr("d",["M",a,b,"L",c,d].join(" ")),blueprint.group[1].attr("d",["M",a,b,"L",f[0],f[1]].join(" ")),blueprint.group[2].attr("d",["M",g[0],g[1],"A",h,h,0,0,0,f[0],f[1]].join(" "))},blueprint.obj.door3.start=function(a,b,c){blueprint.abs.compose2.start(a,b,c,3)},blueprint.obj.door3.prev=function(a,b){blueprint.obj.door3.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.door3.next=blueprint.abs.simple.next,blueprint.obj.door3.end=blueprint.abs.simple.next,blueprint.obj.door3.cancel=blueprint.abs.simple.cancel,blueprint.obj.door3.add=function(a,b){blueprint.abs.compose2.start(+b[1],+b[2],a,3),blueprint.obj.door3.draw(+b[1],+b[2],+b[4],+b[5]),blueprint.abs.simple.next()},blueprint.obj.door3.select=blueprint.abs.compose2.select,blueprint.obj.door4={group:!0},blueprint.obj.door4.draw=function(a,b,c,d){var e=[a-c,b-d],f=[c-e[1],d+e[0]],g=[c+e[1],d-e[0]],h=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2));blueprint.group[0].attr("d",["M",a,b,"L",c,d].join(" ")),blueprint.group[1].attr("d",["M",c,d,"L",f[0],f[1]].join(" ")),blueprint.group[2].attr("d",["M",g[0],g[1],"A",h,h,0,0,1,f[0],f[1]].join(" "))},blueprint.obj.door4.start=function(a,b,c){blueprint.abs.compose2.start(a,b,c,3)},blueprint.obj.door4.prev=function(a,b){blueprint.obj.door4.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.door4.next=blueprint.abs.simple.next,blueprint.obj.door4.end=blueprint.abs.simple.next,blueprint.obj.door4.cancel=blueprint.abs.simple.cancel,blueprint.obj.door4.add=function(a,b){blueprint.abs.compose2.start(+b[1],+b[2],a,3),blueprint.obj.door4.draw(+b[1],+b[2],+b[4],+b[5]),blueprint.abs.simple.next()},blueprint.obj.door4.select=blueprint.abs.compose2.select,blueprint.obj.door5={group:!0},blueprint.obj.door5.draw=function(a,b,c,d){var e=[a-c,b-d],f=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)),g=[Math.PI/2-Math.asin(e[1]/f),Math.PI/2-Math.acos(e[0]/f)],h=[[2*Math.cos(g[0]),2*Math.sin(g[0])],[2*Math.cos(g[1]),2*Math.sin(g[1])],[2*Math.cos(-g[1]),2*Math.sin(-g[1])]],i=e[0]<0?0:e[1]<0?1:2,j=[a-e[0]/1.8,b-e[1]/1.8],k=[a-e[0]/2.2,b-e[1]/2.2];blueprint.group[0].attr("d",["M",a,b,"L",c,d].join(" ")),blueprint.group[1].attr("d",["M",a+h[i][0],b+h[i][1],"L",j[0]+h[i][0],j[1]+h[i][1]].join(" ")),blueprint.group[2].attr("d",["M",k[0]-h[i][0],k[1]-h[i][1],"L",c-h[i][0],d-h[i][1]].join(" "))},blueprint.obj.door5.start=function(a,b,c){blueprint.abs.compose2.start(a,b,c,3)},blueprint.obj.door5.prev=function(a,b){blueprint.obj.door5.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.door5.next=blueprint.abs.simple.next,blueprint.obj.door5.end=blueprint.abs.simple.next,blueprint.obj.door5.cancel=blueprint.abs.simple.cancel,blueprint.obj.door5.add=function(a,b){blueprint.abs.compose2.start(+b[1],+b[2],a,3),blueprint.obj.door5.draw(+b[1],+b[2],+b[4],+b[5]),blueprint.abs.simple.next()},blueprint.obj.door5.select=blueprint.abs.compose2.select,blueprint.obj.door6={group:!0},blueprint.obj.door6.draw=function(a,b,c,d){blueprint.group[0].attr("d",["M",a,b,"L",c,d].join(" "))},blueprint.obj.door6.start=function(a,b,c){blueprint.abs.compose2.start(a,b,c,3)},blueprint.obj.door6.prev=function(a,b){blueprint.obj.door6.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.door6.next=blueprint.abs.simple.next,blueprint.obj.door6.end=blueprint.abs.simple.next,blueprint.obj.door6.cancel=blueprint.abs.simple.cancel,blueprint.obj.door6.add=function(a,b){blueprint.abs.compose2.start(+b[1],+b[2],a,3),blueprint.obj.door6.draw(+b[1],+b[2],+b[4],+b[5]),blueprint.abs.simple.next()},blueprint.obj.door6.select=blueprint.abs.compose2.select,blueprint.obj.door7={group:!0},blueprint.obj.door7.draw=function(a,b,c,d){var e=[(c-a)/2,(d-b)/2],f=[a+e[0],b+e[1]],g=[a+e[1],b-e[0]],h=[c+e[1],d-e[0]],i=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2));blueprint.group[0].attr("d",["M",a,b,"L",c,d].join(" ")),blueprint.group[1].attr("d",["M",a,b,"L",g[0],g[1]].join(" ")),blueprint.group[2].attr("d",["M",c,d,"L",h[0],h[1]].join(" ")),blueprint.group[3].attr("d",["M",g[0],g[1],"A",i,i,0,0,1,f[0],f[1],"A",i,i,0,0,1,h[0],h[1]].join(" "))},blueprint.obj.door7.start=function(a,b,c){blueprint.abs.compose2.start(a,b,c,4)},blueprint.obj.door7.prev=function(a,b){blueprint.obj.door7.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.door7.next=blueprint.abs.simple.next,blueprint.obj.door7.end=blueprint.abs.simple.next,blueprint.obj.door7.cancel=blueprint.abs.simple.cancel,blueprint.obj.door7.add=function(a,b){blueprint.abs.compose2.start(+b[1],+b[2],a,4),blueprint.obj.door7.draw(+b[1],+b[2],+b[4],+b[5]),blueprint.abs.simple.next()},blueprint.obj.door7.select=blueprint.abs.compose2.select,blueprint.obj.window1={group:!0},blueprint.obj.window1.draw=function(a,b,c,d){var e=[a-c,b-d],f=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)),g=[Math.PI/2-Math.asin(e[1]/f),Math.PI/2-Math.acos(e[0]/f)],h=[[4*Math.cos(g[0]),4*Math.sin(g[0])],[4*Math.cos(g[1]),4*Math.sin(g[1])],[4*Math.cos(-g[1]),4*Math.sin(-g[1])]],i=e[0]<0?0:e[1]<0?1:2;blueprint.group[0].attr("d",["M",a,b,"L",c,d].join(" ")),blueprint.group[1].attr("d",["M",a,b,"L",c,d].join(" ")),blueprint.group[2].attr("d",["M",a+h[i][0],b+h[i][1],"L",c+h[i][0],d+h[i][1]].join(" ")),blueprint.group[3].attr("d",["M",a-h[i][0],b-h[i][1],"L",c-h[i][0],d-h[i][1]].join(" "))},blueprint.obj.window1.start=function(a,b,c){blueprint.abs.compose2.start(a,b,c,4)},blueprint.obj.window1.prev=function(a,b){blueprint.obj.window1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.window1.next=blueprint.abs.simple.next,blueprint.obj.window1.end=blueprint.abs.simple.next,blueprint.obj.window1.cancel=blueprint.abs.simple.cancel,blueprint.obj.window1.add=function(a,b){blueprint.abs.compose2.start(+b[1],+b[2],a,4),blueprint.obj.window1.draw(+b[1],+b[2],+b[4],+b[5]),blueprint.abs.simple.next()},blueprint.obj.window1.select=blueprint.abs.compose2.select,blueprint.obj.meter={group:!0,custom:!0},blueprint.obj.meter.translate=function(a){var b=blueprint.selected.select("text"),c=b.node().getBBox(),d=blueprint.selected.select("path").attr("d").split(" "),e=/rotate\((.+),(.+),(.+)\)/.exec(b.attr("transform")),f=(+d[1]+ +d[4]+ +d[7]+ +d[10])/4,g=f-+c.width/2+2,h=(+d[2]+ +d[5]+ +d[8]+ +d[11])/4,i=h+ +c.height/2-4;b.attr("x",g).attr("y",i).attr("transform","rotate("+e[1]+","+f+","+h+")")},blueprint.obj.meter.rotate=function(a,b){var c=blueprint.selected.select("text"),d=c.node().getBBox(),e=blueprint.selected.select("path").attr("d").split(" "),f=/rotate\((.+),(.+),(.+)\)/.exec(c.attr("transform")),g=(+e[1]+ +e[4]+ +e[7]+ +e[10])/4,h=g-+d.width/2+2,i=(+e[2]+ +e[5]+ +e[8]+ +e[11])/4,j=i+ +d.height/2-4,b=180*a[0]/Math.PI;c.attr("x",h).attr("y",j).attr("transform","rotate("+(+f[1]+b)+","+g+","+i+")")},blueprint.obj.meter.draw=function(a,b,c,d){var e=c>a?a:c,f=d>b?b:d,g=c>a?c:a,h=d>b?d:b,i=blueprint.selected.select("path"),j=blueprint.selected.select("text"),k=j.node().getBBox(),l=e+(g-e)/2,m=f+(h-f)/2;i.attr("d",["M",e,f,"L",e,h,"L",g,h,"L",g,f,"Z"].join(" ")),j.attr("x",l-+k.width/2+2).attr("y",m+ +k.height/2-4).attr("transform","rotate(0,"+l+","+m+")")},blueprint.obj.meter.start=function(a,b,c){blueprint.stack=[a,b],blueprint.selected=blueprint.layers[1].append("svg:g").attr("class",c.join(" ")).on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.group=[blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("M")]},blueprint.obj.meter.prev=function(a,b){blueprint.obj.meter.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.meter.next=blueprint.abs.simple.next,blueprint.obj.meter.end=blueprint.abs.simple.next,blueprint.obj.meter.cancel=blueprint.abs.simple.cancel,blueprint.obj.meter.add=function(a,b){blueprint.obj.meter.start(+b[1],+b[2],a),blueprint.obj.meter.draw(+b[1],+b[2],+b[7],+b[8]),blueprint.obj.meter.next()},blueprint.obj.meter.select=blueprint.abs.graph2.select,blueprint.obj.piston1={group:!0,custom:!0},blueprint.obj.piston1.translate=function(a){},blueprint.obj.piston1.rotate=function(a,b){},blueprint.obj.piston1.draw=function(a,b,c,d){blueprint.group[0].attr("d",["M",a,b,"L",c,d].join(" ")),blueprint.group[1].attr("d",["M",a-8,b-4,"L",a-8,b+4,"L",a+8,b+4,"L",a+8,b-4,"Z"].join(" ")),blueprint.group[2].attr("d",["M",a-8,b-4,"L",a-8,b+4,"L",a+8,b-4,"L",a+8,b+4,"Z"].join(" ")),blueprint.group[3].attr("d",["M",c-25,d-20,"L",c-25,d+22,"L",c+70,d+22,"L",c+70,d-20,"Z"].join(" ")),blueprint.group[4].attr("x",c-16).attr("y",d),blueprint.group[5].attr("x",c-8).attr("y",d+15)},blueprint.obj.piston1.start=function(a,b,c){blueprint.stack=[a,b],blueprint.selected=blueprint.layers[1].append("svg:g").attr("class",c.join(" ")).on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.group=[blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("COC-HOR"),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("P = 10 KW")]},blueprint.obj.piston1.prev=function(a,b){blueprint.obj.piston1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.piston1.next=blueprint.abs.simple.next,blueprint.obj.piston1.end=blueprint.abs.simple.next,blueprint.obj.piston1.cancel=blueprint.abs.simple.cancel,blueprint.obj.piston1.add=function(a,b){blueprint.obj.piston1.start(+b[1],+b[2],a),blueprint.obj.piston1.draw(+b[1],+b[2],+b[4],+b[5]),blueprint.obj.piston1.next()},blueprint.obj.piston1.select=blueprint.abs.install.select,blueprint.obj.piston2={group:!0,custom:!0},blueprint.obj.piston2.translate=function(a){},blueprint.obj.piston2.rotate=function(a,b){},blueprint.obj.piston2.draw=function(a,b,c,d){blueprint.group[0].attr("d",["M",a,b,"L",c,d].join(" ")),blueprint.group[1].attr("d",["M",a-4,b-8,"L",a-4,b+8,"L",a+4,b+8,"L",a+4,b-8,"Z"].join(" ")),blueprint.group[2].attr("d",["M",a-4,b-8,"L",a+4,b+8,"L",a-4,b+8,"L",a+4,b-8,"Z"].join(" ")),blueprint.group[3].attr("d",["M",c-25,d-20,"L",c-25,d+22,"L",c+70,d+22,"L",c+70,d-20,"Z"].join(" ")),blueprint.group[4].attr("x",c-16).attr("y",d),blueprint.group[5].attr("x",c-8).attr("y",d+15)},blueprint.obj.piston2.start=function(a,b,c){blueprint.stack=[a,b],blueprint.selected=blueprint.layers[1].append("svg:g").attr("class",c.join(" ")).on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.group=[blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("COC-HOR"),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("P = 10 KW")]},blueprint.obj.piston2.prev=function(a,b){blueprint.obj.piston2.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.piston2.next=blueprint.abs.simple.next,blueprint.obj.piston2.end=blueprint.abs.simple.next,blueprint.obj.piston2.cancel=blueprint.abs.simple.cancel,blueprint.obj.piston2.add=function(a,b){blueprint.obj.piston2.start(+b[1],+b[2],a),blueprint.obj.piston2.draw(+b[1],+b[2],+b[4],+b[5]),blueprint.obj.piston2.next()},blueprint.obj.piston2.select=blueprint.abs.install.select,blueprint.obj.input={group:!0,custom:!0},blueprint.obj.input.translate=function(a){},blueprint.obj.input.rotate=function(a,b){},blueprint.obj.input.draw=function(a,b,c,d){blueprint.group[0].attr("d",["M",a,b,"L",c,d].join(" ")).attr("marker-start","url(#head)"),blueprint.group[1].attr("cx",a).attr("cy",b).attr("r",8),blueprint.group[2].attr("d",["M",a-6,b-3,"L",a-6,b+3,"L",a+6,b+3,"L",a+6,b-3,"Z"].join(" ")),blueprint.group[3].attr("d",["M",c-25,d-20,"L",c-25,d+40,"L",c+110,d+40,"L",c+110,d-20,"Z"].join(" ")),blueprint.group[4].attr("x",c-16).attr("y",d),blueprint.group[5].attr("x",c-8).attr("y",d+15),blueprint.group[6].attr("x",c-8).attr("y",d+30)},blueprint.obj.input.start=function(a,b,c){blueprint.stack=[a,b],blueprint.selected=blueprint.layers[1].append("svg:g").attr("class",c.join(" ")).on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.group=[blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:circle").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("Entrada de Aire"),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("h = 0.30 m"),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("s = 100 cm²")]},blueprint.obj.input.prev=function(a,b){blueprint.obj.input.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.input.next=blueprint.abs.simple.next,blueprint.obj.input.end=blueprint.abs.simple.next,blueprint.obj.input.cancel=blueprint.abs.simple.cancel,blueprint.obj.input.add=function(a,b){blueprint.obj.input.start(+b[1],+b[2],a),blueprint.obj.input.draw(+b[1],+b[2],+b[4],+b[5]),blueprint.obj.input.next()},blueprint.obj.input.select=blueprint.abs.install.select,blueprint.obj.output={group:!0,custom:!0},blueprint.obj.output.translate=function(a){},blueprint.obj.output.rotate=function(a,b){},blueprint.obj.output.draw=function(a,b,c,d){blueprint.group[0].attr("d",["M",a,b,"L",c,d].join(" ")).attr("marker-start","url(#tail)"),blueprint.group[1].attr("cx",a).attr("cy",b).attr("r",8),blueprint.group[2].attr("d",["M",a-6,b-3,"L",a-6,b+3,"L",a+6,b+3,"L",a+6,b-3,"Z"].join(" ")),blueprint.group[3].attr("d",["M",c-25,d-20,"L",c-25,d+61,"L",c+110,d+61,"L",c+110,d-20,"Z"].join(" ")),blueprint.group[4].attr("x",c-16).attr("y",d),blueprint.group[5].attr("x",c-16).attr("y",d+18),blueprint.group[6].attr("x",c-8).attr("y",d+36),blueprint.group[7].attr("x",c-8).attr("y",d+51)},blueprint.obj.output.start=function(a,b,c){blueprint.stack=[a,b],blueprint.selected=blueprint.layers[1].append("svg:g").attr("class",c.join(" ")).on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.group=[blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:circle").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("Salida de Gases"),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("de Combustión"),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("h = 1.80 m"),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("s = 100 cm²")]},blueprint.obj.output.prev=function(a,b){blueprint.obj.output.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.output.next=blueprint.abs.simple.next,blueprint.obj.output.end=blueprint.abs.simple.next,blueprint.obj.output.cancel=blueprint.abs.simple.cancel,blueprint.obj.output.add=function(a,b){blueprint.obj.output.start(+b[1],+b[2],a),blueprint.obj.output.draw(+b[1],+b[2],+b[4],+b[5]),blueprint.obj.input.next()},blueprint.obj.output.select=blueprint.abs.install.select,blueprint.obj.aeration={group:!0,custom:!0},blueprint.obj.aeration.translate=function(a){},blueprint.obj.aeration.rotate=function(a,b){},blueprint.obj.aeration.draw=function(a,b,c,d){var e=[a-c,b-d],f=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)),g=[60*(e[0]/f),60*(e[1]/f)],h=e[0]<0?0:e[1]<0?1:2,i=[Math.PI/2-Math.asin(e[1]/f),Math.PI/2-Math.acos(e[0]/f)],j=[[4*Math.cos(i[0]),4*Math.sin(i[0])],[4*Math.cos(i[1]),4*Math.sin(i[1])],[4*Math.cos(-i[1]),4*Math.sin(-i[1])]],k=[[10*Math.cos(i[0]),10*Math.sin(i[0])],[10*Math.cos(i[1]),10*Math.sin(i[1])],[10*Math.cos(-i[1]),10*Math.sin(-i[1])]],l=[a-j[h][0],b-j[h][1],c-j[h][0],d-j[h][1]],m=[a-k[h][0],b-k[h][1],c-k[h][0],d-k[h][1]],n=[l[0]-(l[0]-l[2])/2,l[1]-(l[1]-l[3])/2],o=[m[0]-(m[0]-m[2])/2,m[1]-(m[1]-m[3])/2],p=[o[0]-n[0],o[1]-n[1]],q=Math.sqrt(Math.pow(p[0],2)+Math.pow(p[1],2)),r=[60*(p[0]/q),60*(p[1]/q)],s=[o[0]+g[0]+r[0],o[1]+g[1]+r[1]];blueprint.group[0].attr("d",["M",a,b,"L",c,d].join(" ")),blueprint.group[1].attr("d",["M",l[0],l[1],"L",l[2],l[3]].join(" ")),blueprint.group[2].attr("d",["M",o[0],o[1],"L",s[0],s[1]].join(" ")).attr("marker-start","url(#head)"),blueprint.group[3].attr("x",s[0]+20).attr("y",s[1]-20),blueprint.group[4].attr("x",s[0]+25).attr("y",s[1]-4)},blueprint.obj.aeration.start=function(a,b,c){blueprint.stack=[a,b],blueprint.selected=blueprint.layers[1].append("svg:g").attr("class",c.join(" ")).on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.group=[blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("Aireación Rapida"),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("≥ 0.40 m²")]},blueprint.obj.aeration.prev=function(a,b){blueprint.obj.aeration.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.aeration.next=blueprint.abs.simple.next,blueprint.obj.aeration.end=blueprint.abs.simple.next,blueprint.obj.aeration.cancel=blueprint.abs.simple.cancel,blueprint.obj.aeration.add=function(a,b){blueprint.obj.aeration.start(+b[1],+b[2],a),blueprint.obj.aeration.draw(+b[1],+b[2],+b[4],+b[5]),blueprint.obj.aeration.next()},blueprint.obj.aeration.select=blueprint.abs.install.select,blueprint.obj.heater={group:!0,custom:!0},blueprint.obj.heater.translate=function(a){},blueprint.obj.heater.rotate=function(a,b){},blueprint.obj.heater.draw=function(a,b,c,d){blueprint.group[0].attr("d",["M",a,b,"L",c,d].join(" ")),blueprint.group[1].attr("cx",a).attr("cy",b).attr("r",8),blueprint.group[2].attr("d",["M",a-5,b+1,"L",a-1,b+1,"L",a-1,b+1,"L",a-1,b+5,"L",a+1,b+5,"L",a+1,b+1,"L",a+5,b+1,"L",a+5,b-1,"L",a+1,b-1,"L",a+1,b-5,"L",a-1,b-5,"L",a-1,b-1,"L",a-3,b-1,"Z"].join(" ")),blueprint.group[3].attr("d",["M",c-25,d-20,"L",c-25,d+40,"L",c+50,d+40,"L",c+50,d-20,"Z"].join(" ")),blueprint.group[4].attr("x",c-16).attr("y",d),blueprint.group[5].attr("x",c-16).attr("y",d+15),blueprint.group[6].attr("x",c-8).attr("y",d+30)},blueprint.obj.heater.start=function(a,b,c){blueprint.stack=[a,b],blueprint.selected=blueprint.layers[1].append("svg:g").attr("class",c.join(" ")).on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.group=[blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:circle").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("PREVISTO"),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("CALEFON"),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove).text("15 [kW]")]},blueprint.obj.heater.prev=function(a,b){blueprint.obj.heater.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.heater.next=blueprint.abs.simple.next,blueprint.obj.heater.end=blueprint.abs.simple.next,blueprint.obj.heater.cancel=blueprint.abs.simple.cancel,blueprint.obj.heater.add=function(a,b){blueprint.obj.heater.start(+b[1],+b[2],a),blueprint.obj.heater.draw(+b[1],+b[2],+b[4],+b[5]),blueprint.obj.heater.next()},blueprint.obj.heater.select=blueprint.abs.install.select,blueprint.obj.room1={group:!0,custom:!0},blueprint.obj.room1.draw=function(a,b,c,d){var e=blueprint.selected.select("text"),f=blueprint.selected.select("path").attr("d").split(" ");e.attr("x",(+f[1]+ +f[4]+ +f[7]+ +f[10])/4).attr("y",(+f[2]+ +f[5]+ +f[8]+ +f[11])/4);var g=e.node().getBBox();e.attr("x",+e.attr("x")-+g.width/2).attr("y",+e.attr("y")-+g.height/2)},blueprint.obj.room1.render=function(a,b,c,d,e,f,g,h){var i=-(a-c)/(b-d),j=i*(e-c);blueprint.group[0].attr("d",["M",a,b,"L",c,d,"L",e,j+d,"L",e+(a-c),j+d+(b-d)].join(" ")),h?blueprint.group[1].attr("x",(a+c+e+(e+(a-c)))/4).attr("y",(b+d+j+d+j+d+(b-d))/4).attr("class","text2").text(g).append("tspan").text(" "+h):blueprint.group[1].attr("x",(a+c+e+(e+(a-c)))/4).attr("y",(b+d+j+d+j+d+(b-d))/4).attr("class","text2").text(g);var k=blueprint.group[1].node().getBBox();blueprint.group[1].attr("x",+blueprint.group[1].attr("x")-+k.width/2).attr("y",+blueprint.group[1].attr("y")-+k.height/2)},blueprint.obj.room1.start=function(a,b,c){blueprint.stack=[a,b],blueprint.selected=blueprint.layers[1].append("svg:g").attr("class",c.join(" ")).on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.group=[blueprint.selected.append("svg:path").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove),blueprint.selected.append("svg:text").on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove)]},blueprint.obj.room1.prev=function(a,b){blueprint.obj.room1.prev1(a,b,blueprint.obj.room1.render,"Dormitorio")},blueprint.obj.room1.prev1=function(a,b,c,d,e){2==blueprint.stack.length?blueprint.group[0].attr("d",["M",blueprint.stack[0],blueprint.stack[1],"L",a,b].join(" ")):4==blueprint.stack.length&&c(blueprint.stack[0],blueprint.stack[1],blueprint.stack[2],blueprint.stack[3],a,b,d,e)},blueprint.obj.room1.next=function(a,b){2==blueprint.stack.length?blueprint.stack=blueprint.stack.concat([a,b]):4==blueprint.stack.length&&(blueprint.group[0].attr("d",blueprint.group[0].attr("d")+" Z"),blueprint.selected.attr("id",blueprint.getid()).on("click",blueprint.click),blueprint.stack=void 0,blueprint.selected=void 0,blueprint.group=void 0)},blueprint.obj.room1.end=blueprint.obj.room1.next,blueprint.obj.room1.cancel=blueprint.abs.simple.cancel,blueprint.obj.room1.add=function(a,b){blueprint.obj.room1.add1(a,b,blueprint.obj.room1.render,"Dormitorio")},blueprint.obj.room1.add1=function(a,b,c,d,e){blueprint.obj.room1.start(+b[1],+b[2],a),blueprint.obj.room1.next(+b[4],+b[5]),c(+b[1],+b[2],+b[4],+b[5],+b[7],+b[8],d,e),blueprint.obj.room1.next(+b[7],+b[8])},blueprint.obj.room1.select=function(a){blueprint.group=[a.select("path"),a.select("text")];var b=blueprint.group[0],c=b.attr("d").split(" ").filter(function(a,b){return b%3!=0}).map(function(a){return+a}),d=Math.atan((c[3]-c[1])/(c[2]-c[0])),e=30,f=[c[0]+(c[2]-c[0])/2,c[1]+(c[3]-c[1])/2];blueprint.deselect(),blueprint.selected=a,blueprint.def=blueprint.obj[a.attr("class").split(" ")[0]],blueprint.layers[1].append("svg:circle").attr("id","handle1").attr("cx",c[0]).attr("cy",c[1]).attr("r",4).attr("class","handle vertex").call(blueprint.drag.rect),blueprint.layers[1].append("svg:circle").attr("id","handle2").attr("cx",c[2]).attr("cy",c[3]).attr("r",4).attr("class","handle vertex").call(blueprint.drag.rect),blueprint.layers[1].append("svg:circle").attr("id","handle3").attr("cx",c[4]).attr("cy",c[5]).attr("r",4).attr("class","handle vertex").call(blueprint.drag.rect),blueprint.layers[1].append("svg:circle").attr("id","handle4").attr("cx",c[6]).attr("cy",c[7]).attr("r",4).attr("class","handle vertex").call(blueprint.drag.rect),blueprint.layers[1].append("svg:line").attr("id","axis").attr("x1",f[0]).attr("y1",f[1]).attr("x2",f[0]+3*e*Math.sin(-d)).attr("y2",f[1]+3*e*Math.cos(-d)).attr("class","handle axis"),blueprint.layers[1].append("svg:circle").attr("id","translate").attr("cx",f[0]-e*Math.sin(-d)).attr("cy",f[1]-e*Math.cos(-d)).attr("r",4).attr("class","handle translate").call(blueprint.drag.translate),blueprint.layers[1].append("svg:circle").attr("id","rotate").attr("cx",f[0]+3*e*Math.sin(-d)).attr("cy",f[1]+3*e*Math.cos(-d)).attr("r",4).attr("class","handle rotate").call(blueprint.drag.rotate),blueprint.layers[1].append("svg:circle").attr("id","centre").attr("cx",f[0]).attr("cy",f[1]).attr("r",4).attr("class","handle centre").call(blueprint.drag.centre)},blueprint.obj.room1.translate=function(a){var b=blueprint.selected.select("text"),c=+b.attr("x"),d=+b.attr("y");b.attr("x",c+a[0]).attr("y",d+a[1])},blueprint.obj.room1.rotate=function(a,b){var c=blueprint.selected.select("text"),d=blueprint.selected.select("path").attr("d").split(" ");c.attr("x",(+d[1]+ +d[4]+ +d[7]+ +d[10])/4).attr("y",(+d[2]+ +d[5]+ +d[8]+ +d[11])/4);var e=c.node().getBBox();c.attr("x",+c.attr("x")-+e.width/2).attr("y",+c.attr("y")-+e.height/2)},blueprint.obj.room2={group:!0,custom:!0,draw:blueprint.obj.room1.draw,start:blueprint.obj.room1.start,prev:function(a,b){blueprint.obj.room1.prev1(a,b,blueprint.obj.room1.render,"Cocina","(V > 8m³)")},next:blueprint.obj.room1.next,end:blueprint.obj.room1.end,cancel:blueprint.obj.room1.cancel,add:function(a,b){blueprint.obj.room1.add1(a,b,blueprint.obj.room1.render,"Cocina","(V > 8m³)")},select:blueprint.obj.room1.select,translate:blueprint.obj.room1.translate,rotate:blueprint.obj.room1.rotate},blueprint.obj.room3={group:!0,custom:!0,draw:blueprint.obj.room1.draw,start:blueprint.obj.room1.start,prev:function(a,b){blueprint.obj.room1.prev1(a,b,blueprint.obj.room1.render,"Baño")},next:blueprint.obj.room1.next,end:blueprint.obj.room1.end,cancel:blueprint.obj.room1.cancel,add:function(a,b){blueprint.obj.room1.add1(a,b,blueprint.obj.room1.render,"Baño")},select:blueprint.obj.room1.select,translate:blueprint.obj.room1.translate,rotate:blueprint.obj.room1.rotate},blueprint.obj.room4={group:!0,custom:!0,draw:blueprint.obj.room1.draw,start:blueprint.obj.room1.start,prev:function(a,b){blueprint.obj.room1.prev1(a,b,blueprint.obj.room1.render,"Tienda")},next:blueprint.obj.room1.next,end:blueprint.obj.room1.end,cancel:blueprint.obj.room1.cancel,add:function(a,b){blueprint.obj.room1.add1(a,b,blueprint.obj.room1.render,"Tienda")},select:blueprint.obj.room1.select,translate:blueprint.obj.room1.translate,rotate:blueprint.obj.room1.rotate},blueprint.obj.room5={group:!0,custom:!0,draw:blueprint.obj.room1.draw,start:blueprint.obj.room1.start,prev:function(a,b){blueprint.obj.room1.prev1(a,b,blueprint.obj.room1.render,"Patio")},next:blueprint.obj.room1.next,end:blueprint.obj.room1.end,cancel:blueprint.obj.room1.cancel,add:function(a,b){blueprint.obj.room1.add1(a,b,blueprint.obj.room1.render,"Patio")},select:blueprint.obj.room1.select,
translate:blueprint.obj.room1.translate,rotate:blueprint.obj.room1.rotate},blueprint.obj.text1={group:!1},blueprint.obj.text1.start=function(a,b,c){blueprint.layers[1].append("svg:text").attr("x",a).attr("y",b).attr("class",c.join(" ")).attr("id",blueprint.getid()).text("<< Doble click para editar >>").on("click",blueprint.click).on("dblclick",function(){var a=prompt("Ingrese el texto de la etiqueta");a&&d3.select(this).html(a)})},blueprint.obj.text1.next=function(){},blueprint.obj.text1.end=function(){},blueprint.obj.text1.cancel=function(){},blueprint.obj.text1.add=function(a,b){var c=b.shift(),d=b.shift();blueprint.layers[1].append("svg:text").attr("x",c).attr("y",d).attr("class",a.join(" ")).attr("id",blueprint.getid()).text(b.join(" "))},blueprint.obj.text1.select=function(a){var b=a.attr("x"),c=a.attr("y"),d=30;blueprint.deselect(),blueprint.selected=a,blueprint.def=blueprint.obj.text1,blueprint.layers[1].append("svg:circle").attr("id","translate").attr("cx",+b-d).attr("cy",c).attr("r",4).attr("class","handle translate").call(blueprint.drag.translate)},blueprint.obj.text2={group:!1,start:blueprint.obj.text1.start,next:blueprint.obj.text1.next,end:blueprint.obj.text1.end,cancel:blueprint.obj.text1.cancel,add:blueprint.obj.text1.add,select:blueprint.obj.text1.select},blueprint.obj.text3={group:!1,start:blueprint.obj.text1.start,next:blueprint.obj.text1.next,end:blueprint.obj.text1.end,cancel:blueprint.obj.text1.cancel,add:blueprint.obj.text1.add,select:blueprint.obj.text1.select},blueprint.obj.text4={group:!1,start:blueprint.obj.text1.start,next:blueprint.obj.text1.next,end:blueprint.obj.text1.end,cancel:blueprint.obj.text1.cancel,add:blueprint.obj.text1.add,select:blueprint.obj.text1.select},blueprint.obj.text5={group:!1,start:blueprint.obj.text1.start,next:blueprint.obj.text1.next,end:blueprint.obj.text1.end,cancel:blueprint.obj.text1.cancel,add:blueprint.obj.text1.add,select:blueprint.obj.text1.select},blueprint.obj.table1={group:!0,custom:!0},blueprint.obj.table1.translate=blueprint.abs.graph2.translate,blueprint.obj.table1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.table1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"table1")},blueprint.obj.table1.start=blueprint.abs.graph2.start,blueprint.obj.table1.prev=function(a,b){blueprint.obj.table1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.table1.next=blueprint.abs.simple.next,blueprint.obj.table1.end=blueprint.abs.simple.next,blueprint.obj.table1.cancel=blueprint.abs.simple.cancel,blueprint.obj.table1.add=blueprint.abs.graph2.add,blueprint.obj.table1.select=blueprint.abs.graph2.select,blueprint.obj.table2={group:!0,custom:!0},blueprint.obj.table2.translate=blueprint.abs.graph2.translate,blueprint.obj.table2.rotate=blueprint.abs.graph2.rotate,blueprint.obj.table2.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"table2")},blueprint.obj.table2.start=blueprint.abs.graph2.start,blueprint.obj.table2.prev=function(a,b){blueprint.obj.table2.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.table2.next=blueprint.abs.simple.next,blueprint.obj.table2.end=blueprint.abs.simple.next,blueprint.obj.table2.cancel=blueprint.abs.simple.cancel,blueprint.obj.table2.add=blueprint.abs.graph2.add,blueprint.obj.table2.select=blueprint.abs.graph2.select,blueprint.obj.table3={group:!0,custom:!0},blueprint.obj.table3.translate=blueprint.abs.graph2.translate,blueprint.obj.table3.rotate=blueprint.abs.graph2.rotate,blueprint.obj.table3.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"table3")},blueprint.obj.table3.start=blueprint.abs.graph2.start,blueprint.obj.table3.prev=function(a,b){blueprint.obj.table3.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.table3.next=blueprint.abs.simple.next,blueprint.obj.table3.end=blueprint.abs.simple.next,blueprint.obj.table3.cancel=blueprint.abs.simple.cancel,blueprint.obj.table3.add=blueprint.abs.graph2.add,blueprint.obj.table3.select=blueprint.abs.graph2.select,blueprint.obj.table4={group:!0,custom:!0},blueprint.obj.table4.translate=blueprint.abs.graph2.translate,blueprint.obj.table4.rotate=blueprint.abs.graph2.rotate,blueprint.obj.table4.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"table4")},blueprint.obj.table4.start=blueprint.abs.graph2.start,blueprint.obj.table4.prev=function(a,b){blueprint.obj.table4.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.table4.next=blueprint.abs.simple.next,blueprint.obj.table4.end=blueprint.abs.simple.next,blueprint.obj.table4.cancel=blueprint.abs.simple.cancel,blueprint.obj.table4.add=blueprint.abs.graph2.add,blueprint.obj.table4.select=blueprint.abs.graph2.select,blueprint.obj.chair1={group:!0,custom:!0},blueprint.obj.chair1.translate=blueprint.abs.graph2.translate,blueprint.obj.chair1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.chair1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"chair1")},blueprint.obj.chair1.start=blueprint.abs.graph2.start,blueprint.obj.chair1.prev=function(a,b){blueprint.obj.chair1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.chair1.next=blueprint.abs.simple.next,blueprint.obj.chair1.end=blueprint.abs.simple.next,blueprint.obj.chair1.cancel=blueprint.abs.simple.cancel,blueprint.obj.chair1.add=blueprint.abs.graph2.add,blueprint.obj.chair1.select=blueprint.abs.graph2.select,blueprint.obj.stand1={group:!0,custom:!0},blueprint.obj.stand1.translate=blueprint.abs.graph2.translate,blueprint.obj.stand1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.stand1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"stand1")},blueprint.obj.stand1.start=blueprint.abs.graph2.start,blueprint.obj.stand1.prev=function(a,b){blueprint.obj.stand1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.stand1.next=blueprint.abs.simple.next,blueprint.obj.stand1.end=blueprint.abs.simple.next,blueprint.obj.stand1.cancel=blueprint.abs.simple.cancel,blueprint.obj.stand1.add=blueprint.abs.graph2.add,blueprint.obj.stand1.select=blueprint.abs.graph2.select,blueprint.obj.stool1={group:!0,custom:!0},blueprint.obj.stool1.translate=blueprint.abs.graph2.translate,blueprint.obj.stool1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.stool1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"stool1")},blueprint.obj.stool1.start=blueprint.abs.graph2.start,blueprint.obj.stool1.prev=function(a,b){blueprint.obj.stool1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.stool1.next=blueprint.abs.simple.next,blueprint.obj.stool1.end=blueprint.abs.simple.next,blueprint.obj.stool1.cancel=blueprint.abs.simple.cancel,blueprint.obj.stool1.add=blueprint.abs.graph2.add,blueprint.obj.stool1.select=blueprint.abs.graph2.select,blueprint.obj.couch1={group:!0,custom:!0},blueprint.obj.couch1.translate=blueprint.abs.graph2.translate,blueprint.obj.couch1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.couch1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"couch1")},blueprint.obj.couch1.start=blueprint.abs.graph2.start,blueprint.obj.couch1.prev=function(a,b){blueprint.obj.couch1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.couch1.next=blueprint.abs.simple.next,blueprint.obj.couch1.end=blueprint.abs.simple.next,blueprint.obj.couch1.cancel=blueprint.abs.simple.cancel,blueprint.obj.couch1.add=blueprint.abs.graph2.add,blueprint.obj.couch1.select=blueprint.abs.graph2.select,blueprint.obj.couch2={group:!0,custom:!0},blueprint.obj.couch2.translate=blueprint.abs.graph2.translate,blueprint.obj.couch2.rotate=blueprint.abs.graph2.rotate,blueprint.obj.couch2.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"couch2")},blueprint.obj.couch2.start=blueprint.abs.graph2.start,blueprint.obj.couch2.prev=function(a,b){blueprint.obj.couch2.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.couch2.next=blueprint.abs.simple.next,blueprint.obj.couch2.end=blueprint.abs.simple.next,blueprint.obj.couch2.cancel=blueprint.abs.simple.cancel,blueprint.obj.couch2.add=blueprint.abs.graph2.add,blueprint.obj.couch2.select=blueprint.abs.graph2.select,blueprint.obj.couch3={group:!0,custom:!0},blueprint.obj.couch3.translate=blueprint.abs.graph2.translate,blueprint.obj.couch3.rotate=blueprint.abs.graph2.rotate,blueprint.obj.couch3.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"couch3")},blueprint.obj.couch3.start=blueprint.abs.graph2.start,blueprint.obj.couch3.prev=function(a,b){blueprint.obj.couch3.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.couch3.next=blueprint.abs.simple.next,blueprint.obj.couch3.end=blueprint.abs.simple.next,blueprint.obj.couch3.cancel=blueprint.abs.simple.cancel,blueprint.obj.couch3.add=blueprint.abs.graph2.add,blueprint.obj.couch3.select=blueprint.abs.graph2.select,blueprint.obj.bookcase1={group:!0,custom:!0},blueprint.obj.bookcase1.translate=blueprint.abs.graph2.translate,blueprint.obj.bookcase1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.bookcase1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"bookcase1")},blueprint.obj.bookcase1.start=blueprint.abs.graph2.start,blueprint.obj.bookcase1.prev=function(a,b){blueprint.obj.bookcase1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.bookcase1.next=blueprint.abs.simple.next,blueprint.obj.bookcase1.end=blueprint.abs.simple.next,blueprint.obj.bookcase1.cancel=blueprint.abs.simple.cancel,blueprint.obj.bookcase1.add=blueprint.abs.graph2.add,blueprint.obj.bookcase1.select=blueprint.abs.graph2.select,blueprint.obj.desktop1={group:!0,custom:!0},blueprint.obj.desktop1.translate=blueprint.abs.graph2.translate,blueprint.obj.desktop1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.desktop1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"desktop1")},blueprint.obj.desktop1.start=blueprint.abs.graph2.start,blueprint.obj.desktop1.prev=function(a,b){blueprint.obj.desktop1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.desktop1.next=blueprint.abs.simple.next,blueprint.obj.desktop1.end=blueprint.abs.simple.next,blueprint.obj.desktop1.cancel=blueprint.abs.simple.cancel,blueprint.obj.desktop1.add=blueprint.abs.graph2.add,blueprint.obj.desktop1.select=blueprint.abs.graph2.select,blueprint.obj.bathtub1={group:!0,custom:!0},blueprint.obj.bathtub1.translate=blueprint.abs.graph2.translate,blueprint.obj.bathtub1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.bathtub1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"bathtub1")},blueprint.obj.bathtub1.start=blueprint.abs.graph2.start,blueprint.obj.bathtub1.prev=function(a,b){blueprint.obj.bathtub1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.bathtub1.next=blueprint.abs.simple.next,blueprint.obj.bathtub1.end=blueprint.abs.simple.next,blueprint.obj.bathtub1.cancel=blueprint.abs.simple.cancel,blueprint.obj.bathtub1.add=blueprint.abs.graph2.add,blueprint.obj.bathtub1.select=blueprint.abs.graph2.select,blueprint.obj.bathtub2={group:!0,custom:!0},blueprint.obj.bathtub2.translate=blueprint.abs.graph2.translate,blueprint.obj.bathtub2.rotate=blueprint.abs.graph2.rotate,blueprint.obj.bathtub2.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"bathtub2")},blueprint.obj.bathtub2.start=blueprint.abs.graph2.start,blueprint.obj.bathtub2.prev=function(a,b){blueprint.obj.bathtub2.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.bathtub2.next=blueprint.abs.simple.next,blueprint.obj.bathtub2.end=blueprint.abs.simple.next,blueprint.obj.bathtub2.cancel=blueprint.abs.simple.cancel,blueprint.obj.bathtub2.add=blueprint.abs.graph2.add,blueprint.obj.bathtub2.select=blueprint.abs.graph2.select,blueprint.obj.bathtub3={group:!0,custom:!0},blueprint.obj.bathtub3.translate=blueprint.abs.graph2.translate,blueprint.obj.bathtub3.rotate=blueprint.abs.graph2.rotate,blueprint.obj.bathtub3.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"bathtub3")},blueprint.obj.bathtub3.start=blueprint.abs.graph2.start,blueprint.obj.bathtub3.prev=function(a,b){blueprint.obj.bathtub3.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.bathtub3.next=blueprint.abs.simple.next,blueprint.obj.bathtub3.end=blueprint.abs.simple.next,blueprint.obj.bathtub3.cancel=blueprint.abs.simple.cancel,blueprint.obj.bathtub3.add=blueprint.abs.graph2.add,blueprint.obj.bathtub3.select=blueprint.abs.graph2.select,blueprint.obj.shower1={group:!0,custom:!0},blueprint.obj.shower1.translate=blueprint.abs.graph2.translate,blueprint.obj.shower1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.shower1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"shower1")},blueprint.obj.shower1.start=blueprint.abs.graph2.start,blueprint.obj.shower1.prev=function(a,b){blueprint.obj.shower1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.shower1.next=blueprint.abs.simple.next,blueprint.obj.shower1.end=blueprint.abs.simple.next,blueprint.obj.shower1.cancel=blueprint.abs.simple.cancel,blueprint.obj.shower1.add=blueprint.abs.graph2.add,blueprint.obj.shower1.select=blueprint.abs.graph2.select,blueprint.obj.shower2={group:!0,custom:!0},blueprint.obj.shower2.translate=blueprint.abs.graph2.translate,blueprint.obj.shower2.rotate=blueprint.abs.graph2.rotate,blueprint.obj.shower2.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"shower2")},blueprint.obj.shower2.start=blueprint.abs.graph2.start,blueprint.obj.shower2.prev=function(a,b){blueprint.obj.shower2.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.shower2.next=blueprint.abs.simple.next,blueprint.obj.shower2.end=blueprint.abs.simple.next,blueprint.obj.shower2.cancel=blueprint.abs.simple.cancel,blueprint.obj.shower2.add=blueprint.abs.graph2.add,blueprint.obj.shower2.select=blueprint.abs.graph2.select,blueprint.obj.shower3={group:!0,custom:!0},blueprint.obj.shower3.translate=blueprint.abs.graph2.translate,blueprint.obj.shower3.rotate=blueprint.abs.graph2.rotate,blueprint.obj.shower3.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"shower3")},blueprint.obj.shower3.start=blueprint.abs.graph2.start,blueprint.obj.shower3.prev=function(a,b){blueprint.obj.shower3.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.shower3.next=blueprint.abs.simple.next,blueprint.obj.shower3.end=blueprint.abs.simple.next,blueprint.obj.shower3.cancel=blueprint.abs.simple.cancel,blueprint.obj.shower3.add=blueprint.abs.graph2.add,blueprint.obj.shower3.select=blueprint.abs.graph2.select,blueprint.obj.bed1={group:!0,custom:!0},blueprint.obj.bed1.translate=blueprint.abs.graph2.translate,blueprint.obj.bed1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.bed1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"bed1")},blueprint.obj.bed1.start=blueprint.abs.graph2.start,blueprint.obj.bed1.prev=function(a,b){blueprint.obj.bed1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.bed1.next=blueprint.abs.simple.next,blueprint.obj.bed1.end=blueprint.abs.simple.next,blueprint.obj.bed1.cancel=blueprint.abs.simple.cancel,blueprint.obj.bed1.add=blueprint.abs.graph2.add,blueprint.obj.bed1.select=blueprint.abs.graph2.select,blueprint.obj.bed2={group:!0,custom:!0},blueprint.obj.bed2.translate=blueprint.abs.graph2.translate,blueprint.obj.bed2.rotate=blueprint.abs.graph2.rotate,blueprint.obj.bed2.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"bed2")},blueprint.obj.bed2.start=blueprint.abs.graph2.start,blueprint.obj.bed2.prev=function(a,b){blueprint.obj.bed2.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.bed2.next=blueprint.abs.simple.next,blueprint.obj.bed2.end=blueprint.abs.simple.next,blueprint.obj.bed2.cancel=blueprint.abs.simple.cancel,blueprint.obj.bed2.add=blueprint.abs.graph2.add,blueprint.obj.bed2.select=blueprint.abs.graph2.select,blueprint.obj.sink1={group:!0,custom:!0},blueprint.obj.sink1.translate=blueprint.abs.graph2.translate,blueprint.obj.sink1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.sink1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"sink1")},blueprint.obj.sink1.start=blueprint.abs.graph2.start,blueprint.obj.sink1.prev=function(a,b){blueprint.obj.sink1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.sink1.next=blueprint.abs.simple.next,blueprint.obj.sink1.end=blueprint.abs.simple.next,blueprint.obj.sink1.cancel=blueprint.abs.simple.cancel,blueprint.obj.sink1.add=blueprint.abs.graph2.add,blueprint.obj.sink1.select=blueprint.abs.graph2.select,blueprint.obj.sink2={group:!0,custom:!0},blueprint.obj.sink2.translate=blueprint.abs.graph2.translate,blueprint.obj.sink2.rotate=blueprint.abs.graph2.rotate,blueprint.obj.sink2.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"sink2")},blueprint.obj.sink2.start=blueprint.abs.graph2.start,blueprint.obj.sink2.prev=function(a,b){blueprint.obj.sink2.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.sink2.next=blueprint.abs.simple.next,blueprint.obj.sink2.end=blueprint.abs.simple.next,blueprint.obj.sink2.cancel=blueprint.abs.simple.cancel,blueprint.obj.sink2.add=blueprint.abs.graph2.add,blueprint.obj.sink2.select=blueprint.abs.graph2.select,blueprint.obj.toilet1={group:!0,custom:!0},blueprint.obj.toilet1.translate=blueprint.abs.graph2.translate,blueprint.obj.toilet1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.toilet1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"toilet1")},blueprint.obj.toilet1.start=blueprint.abs.graph2.start,blueprint.obj.toilet1.prev=function(a,b){blueprint.obj.toilet1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.toilet1.next=blueprint.abs.simple.next,blueprint.obj.toilet1.end=blueprint.abs.simple.next,blueprint.obj.toilet1.cancel=blueprint.abs.simple.cancel,blueprint.obj.toilet1.add=blueprint.abs.graph2.add,blueprint.obj.toilet1.select=blueprint.abs.graph2.select,blueprint.obj.basin1={group:!0,custom:!0},blueprint.obj.basin1.translate=blueprint.abs.graph2.translate,blueprint.obj.basin1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.basin1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"basin1")},blueprint.obj.basin1.start=blueprint.abs.graph2.start,blueprint.obj.basin1.prev=function(a,b){blueprint.obj.basin1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.basin1.next=blueprint.abs.simple.next,blueprint.obj.basin1.end=blueprint.abs.simple.next,blueprint.obj.basin1.cancel=blueprint.abs.simple.cancel,blueprint.obj.basin1.add=blueprint.abs.graph2.add,blueprint.obj.basin1.select=blueprint.abs.graph2.select,blueprint.obj.basin2={group:!0,custom:!0},blueprint.obj.basin2.translate=blueprint.abs.graph2.translate,blueprint.obj.basin2.rotate=blueprint.abs.graph2.rotate,blueprint.obj.basin2.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"basin2")},blueprint.obj.basin2.start=blueprint.abs.graph2.start,blueprint.obj.basin2.prev=function(a,b){blueprint.obj.basin2.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.basin2.next=blueprint.abs.simple.next,blueprint.obj.basin2.end=blueprint.abs.simple.next,blueprint.obj.basin2.cancel=blueprint.abs.simple.cancel,blueprint.obj.basin2.add=blueprint.abs.graph2.add,blueprint.obj.basin2.select=blueprint.abs.graph2.select,blueprint.obj.cooker1={group:!0,custom:!0},blueprint.obj.cooker1.translate=blueprint.abs.graph2.translate,blueprint.obj.cooker1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.cooker1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"cooker1")},blueprint.obj.cooker1.start=blueprint.abs.graph2.start,blueprint.obj.cooker1.prev=function(a,b){blueprint.obj.cooker1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.cooker1.next=blueprint.abs.simple.next,blueprint.obj.cooker1.end=blueprint.abs.simple.next,blueprint.obj.cooker1.cancel=blueprint.abs.simple.cancel,blueprint.obj.cooker1.add=blueprint.abs.graph2.add,blueprint.obj.cooker1.select=blueprint.abs.graph2.select,blueprint.obj.cooker2={group:!0,custom:!0},blueprint.obj.cooker2.translate=blueprint.abs.graph2.translate,blueprint.obj.cooker2.rotate=blueprint.abs.graph2.rotate,blueprint.obj.cooker2.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"cooker2")},blueprint.obj.cooker2.start=blueprint.abs.graph2.start,blueprint.obj.cooker2.prev=function(a,b){blueprint.obj.cooker2.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.cooker2.next=blueprint.abs.simple.next,blueprint.obj.cooker2.end=blueprint.abs.simple.next,blueprint.obj.cooker2.cancel=blueprint.abs.simple.cancel,blueprint.obj.cooker2.add=blueprint.abs.graph2.add,blueprint.obj.cooker2.select=blueprint.abs.graph2.select,blueprint.obj.counter1={group:!0,custom:!0},blueprint.obj.counter1.translate=blueprint.abs.graph2.translate,blueprint.obj.counter1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.counter1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"counter1")},blueprint.obj.counter1.start=blueprint.abs.graph2.start,blueprint.obj.counter1.prev=function(a,b){blueprint.obj.counter1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.counter1.next=blueprint.abs.simple.next,blueprint.obj.counter1.end=blueprint.abs.simple.next,blueprint.obj.counter1.cancel=blueprint.abs.simple.cancel,blueprint.obj.counter1.add=blueprint.abs.graph2.add,blueprint.obj.counter1.select=blueprint.abs.graph2.select,blueprint.obj.fridge1={group:!0,custom:!0},blueprint.obj.fridge1.translate=blueprint.abs.graph2.translate,blueprint.obj.fridge1.rotate=blueprint.abs.graph2.rotate,blueprint.obj.fridge1.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"fridge1")},blueprint.obj.fridge1.start=blueprint.abs.graph2.start,blueprint.obj.fridge1.prev=function(a,b){blueprint.obj.fridge1.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.fridge1.next=blueprint.abs.simple.next,blueprint.obj.fridge1.end=blueprint.abs.simple.next,blueprint.obj.fridge1.cancel=blueprint.abs.simple.cancel,blueprint.obj.fridge1.add=blueprint.abs.graph2.add,blueprint.obj.fridge1.select=blueprint.abs.graph2.select,blueprint.obj.fridge2={group:!0,custom:!0},blueprint.obj.fridge2.translate=blueprint.abs.graph2.translate,blueprint.obj.fridge2.rotate=blueprint.abs.graph2.rotate,blueprint.obj.fridge2.draw=function(a,b,c,d){blueprint.abs.graph2.draw(a,b,c,d,"fridge2")},blueprint.obj.fridge2.start=blueprint.abs.graph2.start,blueprint.obj.fridge2.prev=function(a,b){blueprint.obj.fridge2.draw(blueprint.stack[0],blueprint.stack[1],a,b)},blueprint.obj.fridge2.next=blueprint.abs.simple.next,blueprint.obj.fridge2.end=blueprint.abs.simple.next,blueprint.obj.fridge2.cancel=blueprint.abs.simple.cancel,blueprint.obj.fridge2.add=blueprint.abs.graph2.add,blueprint.obj.fridge2.select=blueprint.abs.graph2.select;var set_view=!1,show_map=!1,map=L.map("map",{zoomControl:!1}),zoom=16,rest={list:"rest/list.php",get:"rest/get.php",check:"rest/check.php",create:"rest/create.php",update:"rest/update.php",svg:"rest/svg.php",png:"rest/png.php"};L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:21,id:"mapbox.streets",accessToken:"pk.eyJ1IjoiamFjb2JpYW4iLCJhIjoiQWFfMjJxYyJ9.O50MgJ-QqbTAQjn6bIstfg"}).addTo(map),$(function(){var a=null,b=!1;blueprint.init("#canvas"),blueprint.setmode("selector"),$("#files").hide(),$(".open").click(function(){$.get(rest.list,function(b){$("#files").toggle(),$(".list").empty(),b.forEach(function(b){var c=$("<a></a>",{text:b}),d=$("<li></li>",{"class":"file",click:function(){var b=$(this).children().first().text();$.get(rest.get+"?file="+b,function(c){a=b,document.title=b,$("#main").empty(),blueprint.counter=0,c.forEach(function(a){if(/^.*::.*$/.test(a)){var b=a.split("::"),c=b[0].trim().split(/ +/),d=b[1].trim().split(/ +/),a=b[2]?b[2].trim().split(/ +/):null;c[0]in blueprint.obj&&"add"in blueprint.obj[c[0]]&&blueprint.obj[c[0]].add(c,d,a)}}),d3.selectAll("#main>path,#main>text,#main>g").on("click",blueprint.click).on("dblclick",blueprint.dblclick).on("mousedown",blueprint.mousedown).on("mousemove",blueprint.mousemove)})}});d.append(c),$(".list").append(d)})})}),$(".close").click(function(){document.title="Nuevo Plano",$("#main").empty(),a=null,b=!1,blueprint.counter=0}),$(".save").click(function(){blueprint.deselect();var b=function(){var a=[];return $("#main").children().each(function(){var b=$(this)[0].attributes["class"].value.trim()+" :: ";switch($(this)[0].tagName){case"g":var c=$(this)[0].firstChild.attributes.d.value.trim(),d=$(this).children("image")[0];d?a.push(b+c+" :: "+d.attributes.x.value.trim()+" "+d.attributes.y.value.trim()+" "+d.attributes.width.value.trim()+" "+d.attributes.height.value.trim()+" "+d.attributes.transform.value.trim()):a.push(b+c);break;case"path":a.push(b+$(this)[0].attributes.d.value.trim());break;case"text":a.push(b+$(this)[0].attributes.x.value.trim()+" "+$(this)[0].attributes.y.value.trim()+" "+$(this)[0].textContent)}}),a},c=function(a,c){c?$.post(rest.create,{file:a,content:b()}).done(function(){}):$.post(rest.update,{file:a,content:b()}).done(function(){})};if(a)c(a,!1);else{var d=prompt("Ingrese el nombre del archivo");d&&$.get(rest.check+"?file="+d,function(b){1==b?alert("El nombre de archivo no puede ser usado."):(a=d,document.title=d,c(d,!0))})}}),$(".cancel").click(function(){$("#files").hide()}),$(".svg").click(function(){window.open(rest.svg+"?file="+a,"_blank")}),$(".png").click(function(){window.open(rest.png+"?file="+a,"_blank")}),$(".selector").click(function(){$(this).addClass("picked"),$(".draw").removeClass("picked"),blueprint.setmode("selector")}),$(".remove").click(function(){blueprint.remove()}),$(".draw").click(function(){$(".selector").removeClass("picked"),$(".draw").removeClass("picked"),$(this).addClass("picked");var a=/^.* (.*) .*$/,b=a.exec($(this).attr("class"))[1];blueprint.setmode("draw",b)}),$(".order").click(function(){if(blueprint.selected){var a=blueprint.selected._groups[0][0].id,b=/^.* (.*)$/.exec($(this).attr("class"))[1],c=$("#"+a);switch(b){case"first":c.parent().append(c),blueprint.def.select(blueprint.selected);break;case"up":c.not(":last-child")&&(c.next().after(c),blueprint.def.select(blueprint.selected));break;case"down":c.not(":first-child")&&c.prev().before(c);break;case"last":c.parent().prepend(c)}}return!1}),$(window).on("keypress",function(a){var b=function(){a.preventDefault(),a.stopPropagation()},c={F1:"button.selector",Home:"button.order.first",End:"button.order.last",PageDown:"button.order.down",PageUp:"button.order.up",t:"button.draw.text1",l:"button.draw.line1",L:"button.draw.polyline1",r:"button.draw.rect1",p:"button.draw.polygon1",a:"button.draw.arc1",Delete:"button.remove"};if(console.log("~>",a.key),a.key in c)$(c[a.key]).trigger("click"),b();else{var d=blueprint.keydown(a);d?b():console.log(a.key)}}),$(".map").click(function(){show_map?($(this).removeClass("picked"),$("#map").hide(),show_map=!1):($(this).addClass("picked"),set_view||(navigator.geolocation.getCurrentPosition(function(a){map.setView([a.coords.latitude,a.coords.longitude],zoom)}),set_view=!0),$("#map").show(),show_map=!0)})});